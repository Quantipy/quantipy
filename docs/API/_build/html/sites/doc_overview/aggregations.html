<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>quantify aggregation engine &mdash; Quantipy 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Quantipy 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Documentation" href="overview.html" />
    <link rel="next" title="View concept introduction" href="views_concept_notation.html" />
    <link rel="prev" title="Links and Stack" href="link_and_stack.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="views_concept_notation.html" title="View concept introduction"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="link_and_stack.html" title="Links and Stack"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Quantipy 0.1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="overview.html" accesskey="U">Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="quantify-aggregation-engine">
<h1><code class="docutils literal"><span class="pre">quantify</span></code> aggregation engine<a class="headerlink" href="#quantify-aggregation-engine" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line"><a class="reference internal" href="../../genindex.html"><span>Index</span></a></div>
<div class="line"><a class="reference internal" href="../../py-modindex.html"><span>Module Index</span></a></div>
</div>
<hr class="docutils" />
<div class="section" id="data-concept">
<h2>Data concept<a class="headerlink" href="#data-concept" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">class:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity(link,</span> <span class="pre">weight=None,</span> <span class="pre">xsect_filter=None)</span></code></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">quantipy.Quantity</span></code> object consists of a matrix-like 1/0 representation
of the case data alongside simple, yet flexible manipulation and analysis
methods. Since <code class="docutils literal"><span class="pre">Quantity</span></code> effectively converts each variable into its dummy
equivalent, Quantipy handles e.g. multiple choice variables natively, i.e. as
if they were &#8220;regular&#8221; ones. Data aggregation is implemented using the <code class="docutils literal"><span class="pre">numpy</span></code>
library&#8217;s vectorization and broadcasting features to offer support for the
full range of statistical analyses using arbitray case record weights. The
data conversion can be illustrated as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>------------------------------
|    xsect    | ysect   | wv |
==============================
| @ 1 2 3 4 5 | @ 1 2 3 | 1  |
==============================
| 1 0 1 0 0 0 | 1 0 1 0 | 1  |
------------------------------
| 1 0 0 1 0 0 | 1 1 1 1 | 1  |
------------------------------
| 1 0 0 0 0 1 | 1 0 0 1 | 1  |
------------------------------
| ... ... ... | ... ... | .. |
------------------------------
</pre></div>
</div>
<p><em>xsect</em> and <em>ysect</em> are the x- and y-variables dummy components of the matrix.
They are extended by their respective total vectors (a series of 1s, indicated
with the <em>&#64;</em> symbol) and followed by the corresponding weight vector, (<em>wv</em>,
which turns into a vector of 1-entries as well if no weight is selected).
Generating a <code class="docutils literal"><span class="pre">Quantity</span></code> object by is done by passing a <code class="docutils literal"><span class="pre">Quantipy.Link</span></code>
(and an optional weight variable) to its constructor. Inspecting a new
<code class="docutils literal"><span class="pre">Quantity</span></code> instance will show:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q8&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Quantity - x: q8, xdef: [1, 2, 3, 4, 5, 96, 98] y: gender, ydef: [1, 2], w: @1</span>
</pre></div>
</div>
<p>The data&#8217;s matrix representation is accessed via the <code class="docutils literal"><span class="pre">matrix</span></code> property. As
the matrix is of type <code class="docutils literal"><span class="pre">numpy.ndarray</span></code>  a quick look at its shape helps to
demonstrate the basic data concept:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">matrix</span>
<span class="go">[[[ 1.  1.  0.]</span>
<span class="go">  [ 0.  0.  0.]</span>
<span class="go">  [ 0.  0.  0.]</span>
<span class="go">  [ 0.  0.  0.]</span>
<span class="go">  [ 0.  0.  0.]</span>
<span class="go">  [ 1.  1.  0.]</span>
<span class="go">  [ 0.  0.  0.]</span>
<span class="go">  [ 0.  0.  0.]]</span>
<span class="go">  ...,</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2367L, 8L, 3L)</span>
</pre></div>
</div>
<p>We can see that the matrix shows data for 2367 row entries (the cases) and the
sectional definitions of the columns reflects the information from above:
<code class="docutils literal"><span class="pre">q.xdef</span></code> has a length of 7, <code class="docutils literal"><span class="pre">q.ydef</span></code> one of 2. With the addition of their
total indicators (<code class="docutils literal"><span class="pre">x</span></code>: 7 codes + 1 total = 8 and <code class="docutils literal"><span class="pre">y</span></code>: 2 codes + 1 total = 3)
the shape reflects the data concept outlined above.</p>
</div>
<div class="section" id="computation-methods">
<h2>Computation methods<a class="headerlink" href="#computation-methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cell-frequencies">
<h3>Cell frequencies<a class="headerlink" href="#cell-frequencies" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.count(show='freq',</span> <span class="pre">margin=True,</span> <span class="pre">as_df=True)</span></code></td>
</tr>
</tbody>
</table>
<p>Using <code class="docutils literal"><span class="pre">count()</span></code> allows to quickly produce contigency table analyses on data
distributions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q8&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">Question              gender</span>
<span class="go">Values                   All            1            2</span>
<span class="go">Question Values</span>
<span class="go">q8       All     2259.769789  1156.803818  1102.965971</span>
<span class="go">         1        870.282554   449.982974   420.299580</span>
<span class="go">         2        235.316156   129.877415   105.438740</span>
<span class="go">         3        531.955628   270.823427   261.132200</span>
<span class="go">         4        905.357857   466.994617   438.363240</span>
<span class="go">         5       1204.815742   619.453850   585.361892</span>
<span class="go">         96       262.102580   144.078833   118.023747</span>
<span class="go">         98        41.822422    24.899174    16.923248</span>
</pre></div>
</div>
<p>By providing <code class="docutils literal"><span class="pre">margin=False</span></code> in the method call, the &#8216;All&#8217;-margins that show
the column and row base sizes are omitted from the output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question             gender</span>
<span class="go">Values                    1           2</span>
<span class="go">Question Values</span>
<span class="go">q8       1       449.982974  420.299580</span>
<span class="go">         2       129.877415  105.438740</span>
<span class="go">         3       270.823427  261.132200</span>
<span class="go">         4       466.994617  438.363240</span>
<span class="go">         5       619.453850  585.361892</span>
<span class="go">         96      144.078833  118.023747</span>
<span class="go">         98       24.899174   16.923248</span>
</pre></div>
</div>
<p>It is also possible to exclusively show the x- and y-axis base sizes using the
<code class="docutils literal"><span class="pre">axis</span></code> parameter, which is set to <code class="docutils literal"><span class="pre">None</span></code> by default. For instance, the
column bases can be computed via:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                   All            1            2</span>
<span class="go">Question Values</span>
<span class="go">q8       All     2259.769789  1156.803818  1102.965971</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                   All</span>
<span class="go">Question Values</span>
<span class="go">q8       1        870.282554</span>
<span class="go">         2        235.316156</span>
<span class="go">         3        531.955628</span>
<span class="go">         4        905.357857</span>
<span class="go">         5       1204.815742</span>
<span class="go">         96       262.102580</span>
<span class="go">         98        41.822422</span>
</pre></div>
</div>
</div>
<div class="section" id="numerical-statistics">
<h3>Numerical statistics<a class="headerlink" href="#numerical-statistics" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.summarize(self,</span> <span class="pre">stat='summary',</span> <span class="pre">axis='x',</span> <span class="pre">margin=True,</span> <span class="pre">as_df=True)</span></code></td>
</tr>
</tbody>
</table>
<p>Similar to <code class="docutils literal"><span class="pre">count()</span></code>, the <code class="docutils literal"><span class="pre">summarize()</span></code> method will by default generate a
summary table of distribution statistics. The <code class="docutils literal"><span class="pre">margin</span></code> parameter controls
showing and hiding the analysis for the total (bivariate) number of cases of
the Link definition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q5_1&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">summarize</span><span class="p">()</span>
<span class="go">Question              gender</span>
<span class="go">Values                   All            1            2</span>
<span class="go">Question Values</span>
<span class="go">q5_1     All     8255.000000  3970.518490  4284.481510</span>
<span class="go">         mean      25.601017    23.970385    27.112158</span>
<span class="go">         stddev    39.929528    38.969433    40.745416</span>
<span class="go">         min        1.000000     1.000000     1.000000</span>
<span class="go">         25%        3.000000     3.000000     3.000000</span>
<span class="go">         median     5.000000     4.000000     5.000000</span>
<span class="go">         75%        5.000000     5.000000     5.000000</span>
<span class="go">         max       98.000000    98.000000    98.000000</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question            gender</span>
<span class="go">Values                   1          2</span>
<span class="go">Question Values</span>
<span class="go">q5_1     mean    23.970385  27.112158</span>
<span class="go">         stddev  38.969433  40.745416</span>
<span class="go">         min      1.000000   1.000000</span>
<span class="go">         25%      3.000000   3.000000</span>
<span class="go">         median   4.000000   5.000000</span>
<span class="go">         75%      5.000000   5.000000</span>
<span class="go">         max     98.000000  98.000000</span>
</pre></div>
</div>
<p>It is also possible to only show isolated statistics by specifying the <code class="docutils literal"><span class="pre">stat</span></code>
parameter as one of the following values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="41%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><code class="docutils literal"><span class="pre">stat</span></code></th>
<th class="head">Calculation</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'mean'</span></code></td>
<td>Arithmetic mean</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'lower_q'</span></code></td>
<td>Lower quartile,
0.25-percentile</td>
<td>see <code class="docutils literal"><span class="pre">'median'</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'median'</span></code></td>
<td>Median, 0.5-percentile</td>
<td>per SPSS Statistics/
Dimensions approach,
method 6 in <a class="footnote-reference" href="#id2" id="id1">[1]</a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'upper_q'</span></code></td>
<td>Upper quartile,
0.75-percentile</td>
<td>see <code class="docutils literal"><span class="pre">'median'</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'var'</span></code></td>
<td>Unbiased (n-1) sample
variance</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'stddev'</span></code></td>
<td>Standard deviation</td>
<td><code class="docutils literal"><span class="pre">np.sqrt(var)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'varcoeff'</span></code></td>
<td>Coefficient of variation</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'sem'</span></code></td>
<td>Standard error of the
mean</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'max'</span></code></td>
<td>Maximum</td>
<td>always unweighted</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">'min'</span></code></td>
<td>Minimum</td>
<td>always unweighted</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">Question            gender</span>
<span class="go">Values                 All          1          2</span>
<span class="go">Question Values</span>
<span class="go">q5_1     mean    25.601017  23.970385  27.112158</span>
</pre></div>
</div>
</div>
<div class="section" id="post-aggregation-arithmetic">
<h3>Post-aggregation arithmetic<a class="headerlink" href="#post-aggregation-arithmetic" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.calc(expression,</span> <span class="pre">axis='x',</span> <span class="pre">result_only=False)</span></code></td>
</tr>
</tbody>
</table>
<p>In contrast to <code class="docutils literal"><span class="pre">count()</span></code> and <code class="docutils literal"><span class="pre">summarize()</span></code>, that are referencing the raw
case data, the Quantity <code class="docutils literal"><span class="pre">calc()</span></code> method can be applied to a selection of
already existing aggregation results. It accepts (very) simple computation
terms given in the <code class="docutils literal"><span class="pre">expression</span></code> parameter, for instance as per:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Difference of 1 and 2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
</pre></div>
</div>
<p>To use it, one of the former must have been run beforehand or the method will
raise an error:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q8&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">expression</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
<span class="go">ValueError: No aggregation to base calculation on.</span>
</pre></div>
</div>
<p>With a result from the <code class="docutils literal"><span class="pre">count()</span></code> method, however, we can compute the
difference between the counts in group 1 and 2:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">expression</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
<span class="go">Question                       gender</span>
<span class="go">Values                            All     1     2</span>
<span class="go">Question Values</span>
<span class="go">q8       All                     2367  1211  1156</span>
<span class="go">         1                        949   473   476</span>
<span class="go">         2                        216   112   104</span>
<span class="go">         3                        595   293   302</span>
<span class="go">         4                        970   507   463</span>
<span class="go">         5                       1235   636   599</span>
<span class="go">         96                       283   165   118</span>
<span class="go">         98                        49    26    23</span>
<span class="go">         Difference of 1 and 2    733   361   372</span>
</pre></div>
</div>
<p>It is also possible to use a scalar value in the calculation expression,
indicated by providing the desired value with the <code class="docutils literal"><span class="pre">constant()</span></code> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q5_1&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">constant</span>  <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="o">.</span><span class="n">constant</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Third of mean&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">constant</span><span class="p">(</span><span class="mi">3</span><span class="p">))}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">expression</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
<span class="go">Question                   gender</span>
<span class="go">Values                          1          2</span>
<span class="go">Question Values</span>
<span class="go">q5_1     mean           23.970385  27.112158</span>
<span class="go">         Third of mean   7.990128   9.037386</span>
</pre></div>
</div>
<p>The outcome of <code class="docutils literal"><span class="pre">calc()</span></code> is appended to the result dataframe by default.
To only show the isolated figures, the <code class="docutils literal"><span class="pre">result_only</span></code> argument can be set to <code class="docutils literal"><span class="pre">True</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">expression</span><span class="o">=</span><span class="n">expr</span><span class="p">,</span> <span class="n">result_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">Question                  gender</span>
<span class="go">Values                         1         2</span>
<span class="go">Question Values</span>
<span class="go">q5_1     Third of mean  7.990128  9.037386</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>Post-aggregation calculations are supported in conjunction with the large
majority of the Quantity class routines of their parameter settings. For
instance, <code class="docutils literal"><span class="pre">calc()</span></code> is capable to use edited Link data from <code class="docutils literal"><span class="pre">group()</span></code> and
can be performed after <code class="docutils literal"><span class="pre">normalize()</span></code> (i.e. on percentage representations
of counts). The outlined functionality is also fully integrated within
the <a class="reference internal" href="views_freq_desc.html"><em>view method features</em></a>.</p>
<p class="last"><strong>Note</strong>, however, that <code class="docutils literal"><span class="pre">calc()</span></code> is not implemented for bases/count-sum
types of <code class="docutils literal"><span class="pre">count()</span></code> aggregations and the <code class="docutils literal"><span class="pre">'summary'</span></code> option of <code class="docutils literal"><span class="pre">summarize()</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="data-manipulation-and-editing">
<h2>Data manipulation and editing<a class="headerlink" href="#data-manipulation-and-editing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="grouping-combining">
<h3>Grouping/combining<a class="headerlink" href="#grouping-combining" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.group(groups,</span> <span class="pre">axis='x',</span> <span class="pre">expand=None,</span> <span class="pre">complete=False)</span></code></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal"><span class="pre">group()</span></code> is a flexible method to arrange code values into groups
on-the-fly using (complex) logical statements. A simple example is to calculate
a net category of values found in the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q8&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">Values                   All            1            2</span>
<span class="go">Question Values</span>
<span class="go">q8       All     2259.769789  1156.803818  1102.965971</span>
<span class="go">         net      980.059615   512.037643   468.021972</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">groups</span></code> parameter can also be provided as a list of dict mappings grouping
names to lists of codes in order to generate multiple nets at once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">grps</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&#39;GROUP A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s">&#39;GROUP B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s">&#39;GROUP C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">98</span><span class="p">]}]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">grps</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Values                     1           2</span>
<span class="go">Question Values</span>
<span class="go">q8       GROUP A  512.037643  468.021972</span>
<span class="go">         GROUP B  859.773667  814.457890</span>
<span class="go">         GROUP C  168.978007  134.946995</span>
</pre></div>
</div>
<p>Notice that the <code class="docutils literal"><span class="pre">expand</span></code> parameter can be set to <code class="docutils literal"><span class="pre">'before'</span></code> or <code class="docutils literal"><span class="pre">'after'</span></code>
to present the originating codes alongside the created groups:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">grps</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="s">&#39;before&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1           2</span>
<span class="go">Question Values</span>
<span class="go">q8       1        449.982974  420.299580</span>
<span class="go">         2        129.877415  105.438740</span>
<span class="go">         GROUP A  512.037643  468.021972</span>
<span class="go">         4        466.994617  438.363240</span>
<span class="go">         5        619.453850  585.361892</span>
<span class="go">         GROUP B  859.773667  814.457890</span>
<span class="go">         96       144.078833  118.023747</span>
<span class="go">         98        24.899174   16.923248</span>
<span class="go">         GROUP C  168.978007  134.946995</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="n">grps</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="s">&#39;after&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1           2</span>
<span class="go">Question Values</span>
<span class="go">q8       GROUP A  512.037643  468.021972</span>
<span class="go">         1        449.982974  420.299580</span>
<span class="go">         2        129.877415  105.438740</span>
<span class="go">         GROUP B  859.773667  814.457890</span>
<span class="go">         4        466.994617  438.363240</span>
<span class="go">         5        619.453850  585.361892</span>
<span class="go">         GROUP C  168.978007  134.946995</span>
<span class="go">         96       144.078833  118.023747</span>
<span class="go">         98        24.899174   16.923248</span>
</pre></div>
</div>
<p>In addition to that, the value order of an <em>expanded</em> result can also be fine
tuned (or even completely handled) within the construction of the code groups
as per:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">grps</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&#39;GROUP A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;expand&#39;</span><span class="p">:</span> <span class="s">&#39;before&#39;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s">&#39;GROUP B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s">&#39;expand&#39;</span><span class="p">:</span> <span class="s">&#39;after&#39;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s">&#39;GROUP C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">98</span><span class="p">],</span> <span class="s">&#39;expand&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">grps</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="s">&#39;after&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1           2</span>
<span class="go">Question Values</span>
<span class="go">q8       1        449.982974  420.299580</span>
<span class="go">         2        129.877415  105.438740</span>
<span class="go">         GROUP A  512.037643  468.021972</span>
<span class="go">         GROUP B  859.773667  814.457890</span>
<span class="go">         4        466.994617  438.363240</span>
<span class="go">         5        619.453850  585.361892</span>
<span class="go">         GROUP C  168.978007  134.946995</span>
</pre></div>
</div>
<p>As can be seen, <code class="docutils literal"><span class="pre">expand</span></code> settings from a group definition will overwrite the
general setting of <code class="docutils literal"><span class="pre">expand</span></code> provided in the <code class="docutils literal"><span class="pre">group()</span></code> method.</p>
<p>In addition,
it is possible to show all remaining codes of a Link&#8217;s data by setting
<code class="docutils literal"><span class="pre">complete</span></code> to <code class="docutils literal"><span class="pre">True</span></code> while preserving any <code class="docutils literal"><span class="pre">expand</span></code> options.</p>
<p><strong>Please note</strong>: An exception is <code class="docutils literal"><span class="pre">None</span></code> when set in a group defintion,
which will be transformed to <code class="docutils literal"><span class="pre">'before'</span></code> in order to show the Link&#8217;s complete
code frame:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="o">&gt;&gt;&gt;</span> <span class="n">q</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">grps</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="s">&#39;after&#39;</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1           2</span>
<span class="go">Question Values</span>
<span class="go">q8       1        449.982974  420.299580</span>
<span class="go">         2        129.877415  105.438740</span>
<span class="go">         GROUP A  512.037643  468.021972</span>
<span class="go">         3        270.823427  261.132200</span>
<span class="go">         GROUP B  859.773667  814.457890</span>
<span class="go">         4        466.994617  438.363240</span>
<span class="go">         5        619.453850  585.361892</span>
<span class="go">         96       144.078833  118.023747</span>
<span class="go">         98        24.899174   16.923248</span>
<span class="go">         GROUP C  168.978007  134.946995</span>
</pre></div>
</div>
<p>To conclude this section, the following snippet shows how <code class="docutils literal"><span class="pre">calc()</span></code>
interacts with <code class="docutils literal"><span class="pre">group()</span></code>. Based on the previous example, we calculate the
difference between <code class="docutils literal"><span class="pre">'GROUP</span> <span class="pre">A'</span></code> and <code class="docutils literal"><span class="pre">'GROUP</span> <span class="pre">B'</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;NPS (A - B)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;GROUP A&#39;</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="s">&#39;GROUP B&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">calc</span><span class="p">(</span><span class="n">expression</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span>
<span class="go">Question                  gender</span>
<span class="go">Values                         1           2</span>
<span class="go">Question Values</span>
<span class="go">q8       1            449.982974  420.299580</span>
<span class="go">         2            129.877415  105.438740</span>
<span class="go">         GROUP A      512.037643  468.021972</span>
<span class="go">         3            270.823427  261.132200</span>
<span class="go">         GROUP B      859.773667  814.457890</span>
<span class="go">         4            466.994617  438.363240</span>
<span class="go">         5            619.453850  585.361892</span>
<span class="go">         96           144.078833  118.023747</span>
<span class="go">         98            24.899174   16.923248</span>
<span class="go">         GROUP C      168.978007  134.946995</span>
<span class="go">         NPS (A - B) -347.736024 -346.435918</span>
</pre></div>
</div>
</div>
<div class="section" id="value-scaling">
<h3>Value scaling<a class="headerlink" href="#value-scaling" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is necessary to modify the value range of the answer codes before
calculating summary statistics as the mean or standard deviation. This can be achieved by simply passing a dict that maps old to new codes into the
<code class="docutils literal"><span class="pre">rescale()</span></code> method, as can be demonstrated by the following comparison. The
original codeframe for the cross-tabulation of <code class="docutils literal"><span class="pre">'q5_1'</span></code> against <code class="docutils literal"><span class="pre">'gender'</span></code>
looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q5_1&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1            2</span>
<span class="go">Question Values</span>
<span class="go">q5_1     1        235.582506   201.090692</span>
<span class="go">         2        330.422152   387.100024</span>
<span class="go">         3       1416.177225  1097.263154</span>
<span class="go">         4         80.147116    57.643281</span>
<span class="go">         5       1044.869495  1476.411102</span>
<span class="go">         97       120.395937    85.547704</span>
<span class="go">         98       742.924059   979.425553</span>
</pre></div>
</div>
<p>After setting up the new value codes and applying them using <code class="docutils literal"><span class="pre">rescale()</span></code> we see this reflected in the aggregation result:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">scaling</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1            2</span>
<span class="go">Question Values</span>
<span class="go">q5_1     0        235.582506   201.090692</span>
<span class="go">         25       330.422152   387.100024</span>
<span class="go">         50      1416.177225  1097.263154</span>
<span class="go">         75        80.147116    57.643281</span>
<span class="go">         100     1044.869495  1476.411102</span>
<span class="go">         97       120.395937    85.547704</span>
<span class="go">         98       742.924059   979.425553</span>
</pre></div>
</div>
<p>To report i.e. meaningful summary statistics, however, we should also get rid
of the non-response or other residual codes, which is equally easy to accomplish.</p>
</div>
<div class="section" id="excluding-limiting">
<h3>Excluding/limiting<a class="headerlink" href="#excluding-limiting" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="filtering">
<h3>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="code-value-scaling-and-exclusion">
<h3>Code value scaling and exclusion<a class="headerlink" href="#code-value-scaling-and-exclusion" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.rescale(scaling)</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.missingfy(codes=None,</span> <span class="pre">keep_codes=False,</span>
<span class="pre">keep_base=True,</span> <span class="pre">inplace=True)</span></code></td>
</tr>
</tbody>
</table>
<p>Adding to the aggregation features, the <code class="docutils literal"><span class="pre">Quantity</span></code> object also provides
utilities to change the factor scaling of the associated case data and to ignore
certain codes from aggregation procedures. A common use case for the latter is
to ignore non-response or residual categories from the sample size when
calculating summary statistics or percentages: Values 96 and 98 from the
now familiar q8 question can be identified as &#8220;None of them&#8221; and &#8220;Don&#8217;t know&#8221;
respectively, <code class="docutils literal"><span class="pre">missingfy()</span></code> helps to get rid of them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">missingfy</span><span class="p">(</span><span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">98</span><span class="p">],</span> <span class="n">keep_base</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question             gender</span>
<span class="go">Values                    1           2          All</span>
<span class="go">Question Values</span>
<span class="go">q8       All     987.825811  968.018976  1955.844787</span>
<span class="go">         1       449.982974  420.299580   870.282554</span>
<span class="go">         2       129.877415  105.438740   235.316156</span>
<span class="go">         3       270.823427  261.132200   531.955628</span>
<span class="go">         4       466.994617  438.363240   905.357857</span>
<span class="go">         5       619.453850  585.361892  1204.815742</span>
<span class="go">         96        0.000000    0.000000     0.000000</span>
<span class="go">         98        0.000000    0.000000     0.000000</span>
</pre></div>
</div>
<p>Since codes 96 and 98 are no longer considered in the aggregation, the
&#8216;All&#8217;-margins now only take into account codes 1 to 5, which is reflected in the
percentage values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question             gender</span>
<span class="go">Values                    1           2         All</span>
<span class="go">Question Values</span>
<span class="go">q8       All     100.000000  100.000000  100.000000</span>
<span class="go">         1        45.552867   43.418527   44.496504</span>
<span class="go">         2        13.147805   10.892218   12.031433</span>
<span class="go">         3        27.416112   26.975938   27.198254</span>
<span class="go">         4        47.274996   45.284571   46.289862</span>
<span class="go">         5        62.708814   60.470084   61.600785</span>
<span class="go">         96        0.000000    0.000000    0.000000</span>
<span class="go">         98        0.000000    0.000000    0.000000</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">rescale()</span></code> method is especially useful in combination with <code class="docutils literal"><span class="pre">describe()</span></code>
as it will transform a scale question on-the-fly. In the following example
the 5-point scale question q5_1 is first cleaned from the non-response options
97 and 98 and then rescaled to range from 0-100 instead from 1 to 5. Without any
modifcations, the <code class="docutils literal"><span class="pre">describe()</span></code> result was looking like this (see above):</p>
<div class="highlight-python"><div class="highlight"><pre>Question              gender
Values                     1            2          All
Question Values
q5_1     All     3970.518490  4284.481510  8255.000000
         mean      23.970385    27.112158    25.601017
         stddev    38.969433    40.745416    39.929528
         min        1.000000     1.000000     1.000000
         25%        3.000000     3.000000     3.000000
         median     4.000000     5.000000     5.000000
         75%        5.000000     5.000000     5.000000
         max       98.000000    98.000000    98.000000
</pre></div>
</div>
<p><strong>Missingfying codes 97 and 98</strong> will correct the sample statictics - the base is
reduced and e.g. the mean is now inside the value range of the 1-to-5 scale:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">missingfy</span><span class="p">(</span><span class="n">codes</span><span class="o">=</span><span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">98</span><span class="p">],</span> <span class="n">keep_base</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1            2          All</span>
<span class="go">Question Values</span>
<span class="go">q5_1     All     3107.198494  3219.508253  6326.706747</span>
<span class="go">         mean       3.440364     3.689914     3.567354</span>
<span class="go">         stddev     1.259799     1.321693     1.297576</span>
<span class="go">         min        1.000000     1.000000     1.000000</span>
<span class="go">         25%        3.000000     3.000000     3.000000</span>
<span class="go">         median     3.000000     3.000000     3.000000</span>
<span class="go">         75%        5.000000     5.000000     5.000000</span>
<span class="go">         max        5.000000     5.000000     5.000000</span>
</pre></div>
</div>
<p><strong>Rescaling to 0-100</strong> is done by simply passing a dict that maps old to new
codes and passing it to <code class="docutils literal"><span class="pre">rescale()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">new_scaling</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">75</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="n">new_scaling</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1            2          All</span>
<span class="go">Question Values</span>
<span class="go">q5_1     All     3107.198494  3219.508253  6326.706747</span>
<span class="go">         mean      61.009105    67.247852    64.183853</span>
<span class="go">         stddev    31.494975    33.042328    32.439408</span>
<span class="go">         min        0.000000     0.000000     0.000000</span>
<span class="go">         25%       50.000000    50.000000    50.000000</span>
<span class="go">         median    50.000000    50.000000    50.000000</span>
<span class="go">         75%      100.000000   100.000000   100.000000</span>
<span class="go">         max      100.000000   100.000000   100.000000</span>
</pre></div>
</div>
<p>As expected, the statistics now range between 0-100.</p>
</div>
</div>
<div class="section" id="computation-result-handling">
<h2>Computation result handling<a class="headerlink" href="#computation-result-handling" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-result-property">
<h3>The <code class="docutils literal"><span class="pre">result</span></code> property<a class="headerlink" href="#the-result-property" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">Quantity</span></code> aggregations results are passed and stored in the object&#8217;s
<code class="docutils literal"><span class="pre">result</span></code> property, i.e. the <code class="docutils literal"><span class="pre">__repr__</span></code> method will return its content
instead of the general description of the object as long as <code class="docutils literal"><span class="pre">result</span></code> is not
<code class="docutils literal"><span class="pre">None</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">link</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">name_project</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q8&#39;</span><span class="p">][</span><span class="s">&#39;gender&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question              gender</span>
<span class="go">Values                     1            2          All</span>
<span class="go">Question Values</span>
<span class="go">q8       All     1156.803818  1102.965971  2259.769789</span>
<span class="go">         1        449.982974   420.299580   870.282554</span>
<span class="go">         2        129.877415   105.438740   235.316156</span>
<span class="go">         3        270.823427   261.132200   531.955628</span>
<span class="go">         4        466.994617   438.363240   905.357857</span>
<span class="go">         5        619.453850   585.361892  1204.815742</span>
<span class="go">         96       144.078833   118.023747   262.102580</span>
<span class="go">         98        24.899174    16.923248    41.822422</span>
</pre></div>
</div>
<p>In the method signatures of <code class="docutils literal"><span class="pre">count()</span></code>, <code class="docutils literal"><span class="pre">describe()</span></code> and <code class="docutils literal"><span class="pre">combine()</span></code> the
<code class="docutils literal"><span class="pre">as_df</span></code> parameter is set to <code class="docutils literal"><span class="pre">True</span></code> by default, which means that computation
results are returned as multi-indexed <code class="docutils literal"><span class="pre">pandas.DataFrame</span></code> before
they are passed to <code class="docutils literal"><span class="pre">result</span></code>: On both the index and the column axis,
the question (=variable) name is presented on the first and the answer code
entries found in the data on the second level of the index.
It is, however, possible to store the underlying raw <code class="docutils literal"><span class="pre">numpy.array</span></code> by setting
<code class="docutils literal"><span class="pre">as_df=False</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">as_df</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">[[ 1156.80381804  1102.96597105  2259.7697891 ]</span>
<span class="go"> [  449.98297371   420.29958038   870.28255409]</span>
<span class="go"> [  129.87741546   105.43874045   235.31615591]</span>
<span class="go"> [  270.8234274    261.13220015   531.95562755]</span>
<span class="go"> [  466.99461685   438.36324012   905.35785697]</span>
<span class="go"> [  619.45385041   585.36189159  1204.815742  ]</span>
<span class="go"> [  144.0788332    118.02374662   262.10257982]</span>
<span class="go"> [   24.89917382    16.92324804    41.82242186]]</span>
</pre></div>
</div>
<p>That makes it possible to use both <code class="docutils literal"><span class="pre">pandas</span></code> and <code class="docutils literal"><span class="pre">numpy</span></code> library methods on
a <code class="docutils literal"><span class="pre">Quantity</span></code> result to further modify the data aggregate:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="go">385.871708399</span>
</pre></div>
</div>
</div>
<div class="section" id="to-df-export">
<h3><code class="docutils literal"><span class="pre">to_df()</span></code> export<a class="headerlink" href="#to-df-export" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.to_df(row_val=None,</span> <span class="pre">col_val=None)</span></code></td>
</tr>
</tbody>
</table>
<p>Any <code class="docutils literal"><span class="pre">Quantity.result</span></code> that has been stored as type <code class="docutils literal"><span class="pre">numpy.array</span></code> can be
transformed to a <code class="docutils literal"><span class="pre">pandas.DataFrame</span></code> and passed to the <code class="docutils literal"><span class="pre">result</span></code> property
using the <code class="docutils literal"><span class="pre">to_df()</span></code> method. Use cases for a manual export range from simply
changing the text displayed in the Values-level of the <code class="docutils literal"><span class="pre">pandas.MultiIndex</span></code> to
applying a well-formatted layout to customizing aggregations or View method
programming.</p>
<p>Consider the simple case first in which the object&#8217;s default
appearance of a column base aggregation result is overwritten: By providing a
new text via the <code class="docutils literal"><span class="pre">row_val</span></code> parameter it changes to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">new_text</span> <span class="o">=</span> <span class="s">&#39;Sample: women only&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="s">&#39;cbase&#39;</span><span class="p">,</span> <span class="n">as_df</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">row_val</span><span class="o">=</span><span class="n">new_text</span><span class="p">)</span>
<span class="go">Question                          gender</span>
<span class="go">Values                                 1            2          All</span>
<span class="go">Question Values</span>
<span class="go">q8       Sample: women only  1156.803818  1102.965971  2259.769789</span>
</pre></div>
</div>
<p>For more complex operations, however, it is important to be aware of the
shape of the aggregation result and provide the matching number of text values:
Picking up the already known result from the previous paragraph, <code class="docutils literal"><span class="pre">to_df()</span></code>
would need to know the values for both the index and the column axis for the
<code class="docutils literal"><span class="pre">pandas.DataFrame</span></code> since it cannot infer them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="n">row_val</span><span class="o">=</span><span class="s">&#39;mean of all counts&#39;</span><span class="p">,</span> <span class="n">col_val</span><span class="o">=</span><span class="s">&#39;just a demo&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question                         gender</span>
<span class="go">Values                      just a demo</span>
<span class="go">Question Values</span>
<span class="go">q8       mean of all counts  385.871708</span>
</pre></div>
</div>
</div>
<div class="section" id="percentages">
<h3>Percentages<a class="headerlink" href="#percentages" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal"><span class="pre">quantipy.Quantity.normalize(on='col')</span></code></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal"><span class="pre">count()</span></code> and <code class="docutils literal"><span class="pre">combine()</span></code> results are always expressed in terms of simple
cell counts. The <code class="docutils literal"><span class="pre">normalize()</span></code> method therefore takes the duty to easily
compute a percentage representation with regard to either the column
(by default) or row base sizes, i.e. changing the result to column or row
percentages. Normalizing works together with both <code class="docutils literal"><span class="pre">numpy.array</span></code> or
<code class="docutils literal"><span class="pre">pandas.DataFrame</span></code> type of results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question             gender</span>
<span class="go">Values                    1           2         All</span>
<span class="go">Question Values</span>
<span class="go">q8       All     100.000000  100.000000  100.000000</span>
<span class="go">         1        38.898815   38.106305   38.512001</span>
<span class="go">         2        11.227264    9.559564   10.413280</span>
<span class="go">         3        23.411353   23.675454   23.540258</span>
<span class="go">         4        40.369388   39.744040   40.064163</span>
<span class="go">         5        53.548738   53.071618   53.315862</span>
<span class="go">         96       12.454906   10.700579   11.598641</span>
<span class="go">         98        2.152411    1.534340    1.850738</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s">&#39;weight_a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">as_df</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s">&#39;row&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_df</span><span class="p">(</span><span class="s">&#39;net - row </span><span class="si">% o</span><span class="s">f codes: 1, 2, 3&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">Question                                   gender</span>
<span class="go">Values                                          1          2  All</span>
<span class="go">Question Values</span>
<span class="go">q8       net - row % of codes: 1, 2, 3  52.367773  47.632227  100</span>
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><p class="first">Hyndman, R. J. and Fan, Y. (1996):</p>
<p><em>Sample Quantiles in Statistical Packages</em></p>
<p class="last">The American Statistician 50, no. 4, 361&#8211;365.</p>
</td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">Quantipy</h2>
    
  </a>
</p>







<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What&#8217;s new?</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="io.html">Data sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_preparation.html">Data preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="weighting.html">Case weight computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="link_and_stack.html">Links and Stack</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href=""><code class="docutils literal"><span class="pre">quantify</span></code> aggregation engine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-concept">Data concept</a></li>
<li class="toctree-l3"><a class="reference internal" href="#computation-methods">Computation methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cell-frequencies">Cell frequencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#numerical-statistics">Numerical statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-aggregation-arithmetic">Post-aggregation arithmetic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-manipulation-and-editing">Data manipulation and editing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#grouping-combining">Grouping/combining</a></li>
<li class="toctree-l4"><a class="reference internal" href="#value-scaling">Value scaling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#excluding-limiting">Excluding/limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtering">Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-value-scaling-and-exclusion">Code value scaling and exclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#computation-result-handling">Computation result handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-result-property">The <code class="docutils literal"><span class="pre">result</span></code> property</a></li>
<li class="toctree-l4"><a class="reference internal" href="#to-df-export"><code class="docutils literal"><span class="pre">to_df()</span></code> export</a></li>
<li class="toctree-l4"><a class="reference internal" href="#percentages">Percentages</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="views_concept_notation.html">View concept introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_freq_desc.html">View method manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sigtesting_onf_view.html">Signficance testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="chain_cluster_build.html">Extraction and Exports</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Quantipy dev team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.3</a>
      
      |
      <a href="../../_sources/sites/doc_overview/aggregations.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>