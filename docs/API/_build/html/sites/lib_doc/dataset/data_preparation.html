

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data preparation &mdash; Quantipy 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Quantipy 0.1.0 documentation" href="../../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Quantipy
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../batch/structuring.html">Define and structure mass aggregations</a></li>
<li class="toctree-l2"><a class="reference internal" href="weighting.html">Case weight computation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="weighting.html#creating-weight-schemes">Creating weight schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="weighting.html#running-the-weightengine">Running the <code class="docutils literal"><span class="pre">WeightEngine</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="io.html">Data sources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="io.html#case-and-meta-data">Case and meta data</a></li>
<li class="toctree-l3"><a class="reference internal" href="io.html#supported-conversions">Supported conversions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="io.html#spss-statistics">SPSS Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#dimensions">Dimensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#decipher">Decipher</a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#ascribe">Ascribe</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../TEST/overview.html">Documentation</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Quantipy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
    <li>Data preparation</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/sites/lib_doc/dataset/data_preparation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="data-preparation">
<h1>Data preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line"><a class="reference internal" href="../../../genindex.html"><span class="std std-ref">Index</span></a></div>
<div class="line"><a class="reference internal" href="../../../py-modindex.html"><span class="std std-ref">Module Index</span></a></div>
</div>
<hr class="docutils" />
<p>Quantipy provides a number of convenience functions for working with
your data. Many of these take advantage of Quantipy variable metadata
and as such can manage, for example, the technical differences between
single- and multiple-choice variables for you.</p>
<p>All of the functions detailed in this article can all be imported using
the following statements:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">quantipy.core.tools.dp.prep</span> <span class="k">import</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">frange</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">recode</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">crosstab</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">frequency</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">get_index_mapper</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">quantipy.core.tools.view.logic</span> <span class="k">import</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">has_any</span><span class="p">,</span> <span class="n">not_any</span><span class="p">,</span> <span class="n">has_count</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">has_all</span><span class="p">,</span> <span class="n">not_all</span><span class="p">,</span> <span class="n">not_count</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">is_lt</span><span class="p">,</span> <span class="n">is_eq</span><span class="p">,</span> <span class="n">is_gt</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">is_le</span><span class="p">,</span> <span class="n">is_ne</span><span class="p">,</span> <span class="n">is_ge</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">union</span><span class="p">,</span> <span class="n">intersection</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="data-management">
<h2>Data management<a class="headerlink" href="#data-management" title="Permalink to this headline">¶</a></h2>
<div class="section" id="frange">
<h3><code class="docutils literal"><span class="pre">frange</span></code><a class="headerlink" href="#frange" title="Permalink to this headline">¶</a></h3>
<p>This function takes a string of abbreviated ranges, possibly delimited
by a comma (or some other character) and extrapolates its full,
unabbreviated list of ints.</p>
<div class="section" id="signature-docstring">
<h4>Signature/Docstring<a class="headerlink" href="#signature-docstring" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">frange</span><span class="p">(</span><span class="n">range_def</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Return the full, unabbreviated list of ints suggested by range_def.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    This function takes a string of abbreviated ranges, possibly</span>
<span class="gp">... </span><span class="sd">    delimited by a comma (or some other character) and extrapolates</span>
<span class="gp">... </span><span class="sd">    its full, unabbreviated list of ints.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    range_def : str</span>
<span class="gp">... </span><span class="sd">        The range string to be listed in full.</span>
<span class="gp">... </span><span class="sd">    sep : str, default=&#39;,&#39;</span>
<span class="gp">... </span><span class="sd">        The character that should be used to delimit discrete entries in</span>
<span class="gp">... </span><span class="sd">        range_def.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    res : list</span>
<span class="gp">... </span><span class="sd">        The exploded list of ints indicated by range_def.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-range">
<h4>Basic range<a class="headerlink" href="#basic-range" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-5&#39;</span><span class="p">)</span>
<span class="go">[1, 2, 3, 4, 5]</span>
</pre></div>
</div>
</div>
<div class="section" id="range-in-reverse">
<h4>Range in reverse<a class="headerlink" href="#range-in-reverse" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frange</span><span class="p">(</span><span class="s1">&#39;15-11&#39;</span><span class="p">)</span>
<span class="go">[15, 14, 13, 12, 11]</span>
</pre></div>
</div>
</div>
<div class="section" id="combination">
<h4>Combination<a class="headerlink" href="#combination" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-5,7,9,15-11&#39;</span><span class="p">)</span>
<span class="go">[1, 2, 3, 4, 5, 7, 9, 15, 14, 13, 12, 11]</span>
</pre></div>
</div>
</div>
<div class="section" id="may-include-spaces-for-clarity">
<h4>May include spaces for clarity<a class="headerlink" href="#may-include-spaces-for-clarity" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-5, 7, 9, 15-11&#39;</span><span class="p">)</span>
<span class="go">[1, 2, 3, 4, 5, 7, 9, 15, 14, 13, 12, 11]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="recode">
<h3><code class="docutils literal"><span class="pre">recode</span></code><a class="headerlink" href="#recode" title="Permalink to this headline">¶</a></h3>
<p>This function takes a mapper of <code class="docutils literal"><span class="pre">{key:</span> <span class="pre">logic}</span></code> entries and injects the
key into the target column where its paired logic is True. The logic
may be arbitrarily complex and may refer to any other variable or
variables in data. Where a pre-existing column has been used to
start the recode, the injected values can replace or be appended to
any data found there to begin with. Note that this function does
not edit the target column, it returns a recoded copy of the target
column. The recoded data will always comply with the column type
indicated for the target column according to the meta.</p>
<div class="section" id="id1">
<h4>Signature/Docstring<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">recode</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">intersect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fillna</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Return a recoded copy of the target column using the given mapper.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    This function takes a mapper of {key: logic} entries and injects the</span>
<span class="gp">... </span><span class="sd">    key into the target column where its paired logic is True. The logic</span>
<span class="gp">... </span><span class="sd">    may be arbitrarily complex and may refer to any other variable or</span>
<span class="gp">... </span><span class="sd">    variables in data. Where a pre-existing column has been used to</span>
<span class="gp">... </span><span class="sd">    start the recode, the injected values can replace or be appended to</span>
<span class="gp">... </span><span class="sd">    any data found there to begin with. Note that this function does</span>
<span class="gp">... </span><span class="sd">    not edit the target column, it returns a recoded copy of the target</span>
<span class="gp">... </span><span class="sd">    column. The recoded data will always comply with the column type</span>
<span class="gp">... </span><span class="sd">    indicated for the target column according to the meta.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    meta : dict</span>
<span class="gp">... </span><span class="sd">        Quantipy meta document.</span>
<span class="gp">... </span><span class="sd">    data : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        Data accompanying the given meta document.</span>
<span class="gp">... </span><span class="sd">    target : str</span>
<span class="gp">... </span><span class="sd">        The column name that is the target of the recode. If target</span>
<span class="gp">... </span><span class="sd">        is not found in meta[&#39;columns&#39;] this will fail with an error.</span>
<span class="gp">... </span><span class="sd">        If target is not found in data.columns the recode will start</span>
<span class="gp">... </span><span class="sd">        from an empty series with the same index as data. If target</span>
<span class="gp">... </span><span class="sd">        is found in data.columns the recode will start from a copy</span>
<span class="gp">... </span><span class="sd">        of that column.</span>
<span class="gp">... </span><span class="sd">    mapper : dict</span>
<span class="gp">... </span><span class="sd">        A mapper of {key: logic} entries.</span>
<span class="gp">... </span><span class="sd">    default : str</span>
<span class="gp">... </span><span class="sd">        The column name to default to in cases where unattended lists</span>
<span class="gp">... </span><span class="sd">        are given in your logic, where an auto-transformation of</span>
<span class="gp">... </span><span class="sd">        {key: list} to {key: {default: list}} is provided. Note that</span>
<span class="gp">... </span><span class="sd">        lists in logical statements are themselves a form of shorthand</span>
<span class="gp">... </span><span class="sd">        and this will ultimately be interpreted as:</span>
<span class="gp">... </span><span class="sd">        {key: {default: has_any(list)}}.</span>
<span class="gp">... </span><span class="sd">    append : bool, default=False</span>
<span class="gp">... </span><span class="sd">        Should the new recodd data be appended to items already found</span>
<span class="gp">... </span><span class="sd">        in series? If False, data from series (where found) will</span>
<span class="gp">... </span><span class="sd">        overwrite whatever was found for that item in ds1 instead.</span>
<span class="gp">... </span><span class="sd">    intersect : logical statement, default=None</span>
<span class="gp">... </span><span class="sd">        If a logical statement is given here then it will be used as an</span>
<span class="gp">... </span><span class="sd">        implied intersection of all logical conditions given in the</span>
<span class="gp">... </span><span class="sd">        mapper.</span>
<span class="gp">... </span><span class="sd">    initialize : str or np.NaN, default=None</span>
<span class="gp">... </span><span class="sd">        If not None, a copy of the data named column will be used to</span>
<span class="gp">... </span><span class="sd">        populate the target column before the recode is performed.</span>
<span class="gp">... </span><span class="sd">        Alternatively, initialize can be used to populate the target</span>
<span class="gp">... </span><span class="sd">        column with np.NaNs (overwriting whatever may be there) prior</span>
<span class="gp">... </span><span class="sd">        to the recode.</span>
<span class="gp">... </span><span class="sd">    fillna : int, default=None</span>
<span class="gp">... </span><span class="sd">        If not None, the value passed to fillna will be used on the</span>
<span class="gp">... </span><span class="sd">        recoded series as per pandas.Series.fillna().</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    series : pandas.Series</span>
<span class="gp">... </span><span class="sd">        The series in which the recoded data will be stored and</span>
<span class="gp">... </span><span class="sd">        returned.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="target">
<h4>target<a class="headerlink" href="#target" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">target</span></code> controls which column meta should be used to control the
result of the recode operation. This is important because you cannot
recode multiple responses into a &#8216;single&#8217;-typed column.</p>
<p>The <code class="docutils literal"><span class="pre">target</span></code> column <strong>must</strong> already exist in meta.</p>
<p>The <code class="docutils literal"><span class="pre">recode</span></code> function is effectively a request to return a copy of
the <code class="docutils literal"><span class="pre">target</span></code> column, recoded as instructed. <code class="docutils literal"><span class="pre">recode</span></code> does not
edit the <code class="docutils literal"><span class="pre">target</span></code> column in place, it returns a recoded copy of it.</p>
<p>If the <code class="docutils literal"><span class="pre">target</span></code> column does not already exist in <code class="docutils literal"><span class="pre">data</span></code> then a new
series, named accordingly and initialized with <code class="docutils literal"><span class="pre">np.NaN</span></code>, will begin
the recode.</p>
<p>Return a recoded version of the column <code class="docutils literal"><span class="pre">radio_stations_xb</span></code> edited
based on the given mapper:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="n">mapper</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>By dfault, recoded data resulting from the the mapper will replace any
data already sitting in the target column (on a cell-by-cell basis).</p>
</div>
<div class="section" id="mapper">
<h4>mapper<a class="headerlink" href="#mapper" title="Permalink to this headline">¶</a></h4>
<p>A mapper is a dict of <code class="docutils literal"><span class="pre">{value:</span> <span class="pre">logic}</span></code> entries where value represents
the data that will be injected for cases where the logic is True.</p>
<p>Here&#8217;s a simplified example of what a mapper looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="p">:</span> <span class="n">logic_A</span><span class="p">,</span>
<span class="gp">... </span>    <span class="mi">2</span><span class="p">:</span> <span class="n">logic_B</span><span class="p">,</span>
<span class="gp">... </span>    <span class="mi">3</span><span class="p">:</span> <span class="n">logic_C</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>1 will be generated where <code class="docutils literal"><span class="pre">logic_A</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, 2 where <code class="docutils literal"><span class="pre">logic_B</span></code> is
<code class="docutils literal"><span class="pre">True</span></code> and 3 where <code class="docutils literal"><span class="pre">logic_C</span></code> is <code class="docutils literal"><span class="pre">True</span></code>.</p>
<p>The recode function, by referencing the type indicated by the meta,
will manage the complications involved in single vs delimited set
data.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">901</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="mi">902</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="mi">903</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">)}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>This means: inject 901 if the column <code class="docutils literal"><span class="pre">radio_stations</span></code> has any of the
values 1-13, 902 where <code class="docutils literal"><span class="pre">radio_stations</span></code> has any of the values 14-20
and 903 where <code class="docutils literal"><span class="pre">radio_stations</span></code> has any of the values 21-25.</p>
</div>
<div class="section" id="default">
<h4>default<a class="headerlink" href="#default" title="Permalink to this headline">¶</a></h4>
<p>If you had lots of values to generate from the same reference column
(say most/all of them were based on <code class="docutils literal"><span class="pre">radio_stations</span></code>) then we can
omit the wildcard logic format and use recode&#8217;s default parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>This means, all unkeyed logic will default to be keyed to
<code class="docutils literal"><span class="pre">radio_stations</span></code>. In this case the three codes 901, 902 and 903 will
be generated based on the data found in <code class="docutils literal"><span class="pre">radio_stations</span></code>.</p>
<p>You can combine this with reference to other columns, but you can only
provide one default column.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Given that logic can be arbitrarily complicated, mappers can be as
well. You&#8217;ll see an example of a mapper that recodes a segmentation
in <strong>Example 4</strong>, below.</p>
</div>
<div class="section" id="append">
<h4>append<a class="headerlink" href="#append" title="Permalink to this headline">¶</a></h4>
<p>If you want the recoded data to be appended to whatever may
already be in the target column (this is only applicable for &#8216;delimited
set&#8217;-typed columns), then you should use the append parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="n">mapper</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>The precise behaviour of the append parameter can be seen in the
following examples.</p>
<p>Given the following data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span>
<span class="go">1    6;7;9;13;</span>
<span class="go">2          97;</span>
<span class="go">3          97;</span>
<span class="go">4    13;16;18;</span>
<span class="go">5         2;6;</span>
<span class="go">Name: radio_stations_xb, dtype: object</span>
</pre></div>
</div>
<p>We generate a recoded value of 901 if any of the values 1-13 are
found. With the default <code class="docutils literal"><span class="pre">append=False</span></code> behaviour we will return the
following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;radio_stations_xb&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recode</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapper</span><span class="p">)</span>
<span class="go">1    901;</span>
<span class="go">2     97;</span>
<span class="go">3     97;</span>
<span class="go">4    901;</span>
<span class="go">5    901;</span>
<span class="go">Name: radio_stations_xb, dtype: object</span>
</pre></div>
</div>
<p>However, if we instead use <code class="docutils literal"><span class="pre">append=True</span></code>, we will return the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;radio_stations_xb&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recode</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">1    6;7;9;13;901;</span>
<span class="go">2              97;</span>
<span class="go">3              97;</span>
<span class="go">4    13;16;18;901;</span>
<span class="go">5         2;6;901;</span>
<span class="go">Name: radio_stations_xb, dtype: object</span>
</pre></div>
</div>
</div>
<div class="section" id="intersect">
<h4>intersect<a class="headerlink" href="#intersect" title="Permalink to this headline">¶</a></h4>
<p>One way to help simplify complex logical conditions, especially when
they are in some way repetitive, is to use <code class="docutils literal"><span class="pre">intersect</span></code>, which
accepts any logical statement and forces every condition in the mapper
to become the intersection of both it and the intersect condition.</p>
<p>For example, we could limit our recode to males by giving a logical
condition to that effect to <code class="docutils literal"><span class="pre">intersect</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">intersect</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize">
<h4>initialize<a class="headerlink" href="#initialize" title="Permalink to this headline">¶</a></h4>
<p>You may also <code class="docutils literal"><span class="pre">initialize</span></code> your copy of the target column as part of your
recode operation. You can <code class="docutils literal"><span class="pre">initalize</span></code> with either np.NaN (to overwrite
anything that may already be there when your recode begins) or by naming
another column. When you name another column a copy of the data from that
column is used to initialize your recode.</p>
<p>Initialization occurs <strong>before</strong> your recode.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initialize</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fillna">
<h4>fillna<a class="headerlink" href="#fillna" title="Permalink to this headline">¶</a></h4>
<p>You may also provide a <code class="docutils literal"><span class="pre">fillna</span></code> value that will be used as per
<code class="docutils literal"><span class="pre">pd.Series.fillna()</span></code> <strong>after</strong> the recode has been performed.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">fillna</span><span class="o">=</span><span class="mi">99</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example-1">
<h4>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h4>
<p>Here&#8217;s an example of copying an existing question and recoding onto it a
net code.</p>
<p>Create the new metadata:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">901</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;NET: Listened to radio in past 30 days&quot;</span><span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Initialize the new column. In this case we&#8217;re starting with a copy of
the <code class="docutils literal"><span class="pre">radio_stations</span></code> column:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>Recode the new column by appending the code 901 to it as indicated
by the mapper:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-23, 92, 94, 141&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span> <span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">   radio_stations radio_stations_cb</span>
<span class="go">0              5;            5;901;</span>
<span class="go">1             97;               97;</span>
<span class="go">2             97;               97;</span>
<span class="go">3             97;               97;</span>
<span class="go">4             97;               97;</span>
<span class="go">5              4;            4;901;</span>
<span class="go">6             11;           11;901;</span>
<span class="go">7              4;            4;901;</span>
<span class="go">8             97;               97;</span>
<span class="go">9             97;               97;</span>
<span class="go">10            97;               97;</span>
<span class="go">11            92;           92;901;</span>
<span class="go">12            97;               97;</span>
<span class="go">13       1;13;17;      1;13;17;901;</span>
<span class="go">14             6;            6;901;</span>
<span class="go">15      1;5;6;10;     1;5;6;10;901;</span>
<span class="go">16             6;            6;901;</span>
<span class="go">17        2;4;16;       2;4;16;901;</span>
<span class="go">18          6;10;         6;10;901;</span>
<span class="go">19             6;            6;901;</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2">
<h4>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h4>
<p>Here&#8217;s an example where the value 1 is generated based on some logic
and then all remaining cases are given the value 2 using the
pandas.Series.fillna() method.</p>
<p>Create the new metadata</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Age&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;16-25&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Others&#39;</span><span class="p">}}</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<p>Initialize the new column:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
</pre></div>
</div>
<p>Recode the new column:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;age_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;16-40&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Fill all cases that are still empty with the value 2:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_xb&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">    age  age_grp_rc</span>
<span class="go">0    22           1</span>
<span class="go">1    68           2</span>
<span class="go">2    32           1</span>
<span class="go">3    44           2</span>
<span class="go">4    33           1</span>
<span class="go">5    52           2</span>
<span class="go">6    54           2</span>
<span class="go">7    44           2</span>
<span class="go">8    62           2</span>
<span class="go">9    49           2</span>
<span class="go">10   64           2</span>
<span class="go">11   73           2</span>
<span class="go">12   43           2</span>
<span class="go">13   28           1</span>
<span class="go">14   66           2</span>
<span class="go">15   39           1</span>
<span class="go">16   51           2</span>
<span class="go">17   50           2</span>
<span class="go">18   77           2</span>
<span class="go">19   42           2</span>
</pre></div>
</div>
</div>
<div class="section" id="example-3">
<h4>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h4>
<p>Here&#8217;s a typical example of recoding age into custom bands.</p>
<p>In this case we&#8217;re using list comprehension to generate the first ten
values objects and then concatenate that with a final &#8216;65+&#8217; value object
which doesn&#8217;t folow the same label format.</p>
<p>Create the new metadata:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Age&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])}</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span> <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span> <span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span> <span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">61</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>
<span class="gp">... </span>            <span class="p">],</span>
<span class="gp">... </span>            <span class="n">start</span><span class="o">=</span><span class="mi">1</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;65+&#39;</span><span class="p">}</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Initialize the new column:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
</pre></div>
</div>
<p>Recode the new column:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">1</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">2</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">3</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;26-30&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">4</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;31-35&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">5</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;36-40&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">6</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;41-45&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">7</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;46-50&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">8</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;51-55&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">9</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;56-60&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">10</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;61-65&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">11</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;66-99&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;age&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_xb_1&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">    age  age_cb</span>
<span class="go">0    22       2</span>
<span class="go">1    68      11</span>
<span class="go">2    32       4</span>
<span class="go">3    44       6</span>
<span class="go">4    33       4</span>
<span class="go">5    52       8</span>
<span class="go">6    54       8</span>
<span class="go">7    44       6</span>
<span class="go">8    62      10</span>
<span class="go">9    49       7</span>
<span class="go">10   64      10</span>
<span class="go">11   73      11</span>
<span class="go">12   43       6</span>
<span class="go">13   28       3</span>
<span class="go">14   66      11</span>
<span class="go">15   39       5</span>
<span class="go">16   51       8</span>
<span class="go">17   50       7</span>
<span class="go">18   77      11</span>
<span class="go">19   42       6</span>
</pre></div>
</div>
</div>
<div class="section" id="example-4">
<h4>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h4>
<p>Here&#8217;s an example of using a complicated, nested series of logic
statements to recode an obscure segmentation.</p>
<p>The segemenation was given with the following definition:</p>
<p><strong>1 - Self-directed:</strong></p>
<ul class="simple">
<li>If q1_1 in [1,2] and q1_2 in [1,2] and q1_3 in [3,4,5]</li>
</ul>
<p><strong>2 - Validators:</strong></p>
<ul class="simple">
<li>If q1_1 in [1,2] and q1_2 in [1,2] and q1_3 in [1,2]</li>
</ul>
<p><strong>3 - Delegators:</strong></p>
<ul class="simple">
<li>If (q1_1 in [3,4,5] and q1_2 in [3,4,5] and q1_3 in [1,2])</li>
<li>Or (q1_1 in [3,4,5] and q1_2 in [1,2] and q1_3 in [1,2])</li>
<li>Or (q1_1 in [1,2] and q1_2 in [3,4,5] and q1_3 in [1,2])</li>
</ul>
<p><strong>4 - Avoiders:</strong></p>
<ul class="simple">
<li>If (q1_1 in [3,4,5] and q1_2 in [3,4,5] and q1_3 in [3,4,5])</li>
<li>Or (q1_1 in [3,4,5] and q1_2 in [1,2] and q1_3 in [3,4,5])</li>
<li>Or (q1_1 in [1,2] and q1_2 in [3,4,5] and q1_3 in [3,4,5])</li>
</ul>
<p><strong>5 - Others:</strong></p>
<ul class="simple">
<li>Everyone else.</li>
</ul>
<p>Create the new metadata:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Segments&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Self-directed&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Validators&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Delegators&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Avoiders&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Other&#39;</span><span class="p">}},</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Initialize the new column?</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
</pre></div>
</div>
<p>Create the mapper separately, since it&#8217;s pretty massive!</p>
<p>See the <strong>Complex logic</strong> section for more information and examples
related to the use of <code class="docutils literal"><span class="pre">union</span></code> and <code class="docutils literal"><span class="pre">intersection</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="p">:</span> <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>    <span class="p">]),</span>
<span class="gp">... </span>    <span class="mi">2</span><span class="p">:</span> <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>    <span class="p">]),</span>
<span class="gp">... </span>    <span class="mi">3</span><span class="p">:</span> <span class="n">union</span><span class="p">([</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>    <span class="p">]),</span>
<span class="gp">... </span>    <span class="mi">4</span><span class="p">:</span> <span class="n">union</span><span class="p">([</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">])</span>
<span class="gp">... </span>    <span class="p">])</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Recode the new column:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;segments&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="n">mapper</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Anything not at the top level of the mapper will not benefit from using
the <code class="docutils literal"><span class="pre">default</span></code> parameter of the recode function. In this case, for example,
saying <code class="docutils literal"><span class="pre">default='q1_1'</span></code> would not have helped. Everything in a nested level
of the mapper, including anything in a <code class="docutils literal"><span class="pre">union</span></code> or <code class="docutils literal"><span class="pre">intersection</span></code> list,
must use the explicit dict form <code class="docutils literal"><span class="pre">{&quot;q1_1&quot;:</span> <span class="pre">[1,</span> <span class="pre">2]}</span></code>.</p>
</div>
<p>Fill all cases that are still empty with the value 5:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;q1_1&#39;</span><span class="p">,</span> <span class="s1">&#39;q1_2&#39;</span><span class="p">,</span> <span class="s1">&#39;q1_3&#39;</span><span class="p">,</span> <span class="s1">&#39;segments&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">    q1_1  q1_2  q1_3  segments</span>
<span class="go">0      3     3     3         4</span>
<span class="go">1      3     3     3         4</span>
<span class="go">2      1     1     3         1</span>
<span class="go">3      1     1     2         2</span>
<span class="go">4      2     2     2         2</span>
<span class="go">5      1     1     5         1</span>
<span class="go">6      2     3     2         3</span>
<span class="go">7      2     2     3         1</span>
<span class="go">8      1     1     4         1</span>
<span class="go">9      3     3     3         4</span>
<span class="go">10     3     3     4         4</span>
<span class="go">11     2     2     4         1</span>
<span class="go">12     1     1     5         1</span>
<span class="go">13     2     2     4         1</span>
<span class="go">14     1     1     1         2</span>
<span class="go">15     2     2     4         1</span>
<span class="go">16     2     2     3         1</span>
<span class="go">17     1     1     5         1</span>
<span class="go">18     5     5     1         3</span>
<span class="go">19     1     1     4         1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="get-index-mapper">
<h3><code class="docutils literal"><span class="pre">get_index_mapper</span></code><a class="headerlink" href="#get-index-mapper" title="Permalink to this headline">¶</a></h3>
<p>This function converts a mapper in the form
<code class="docutils literal"><span class="pre">{key:</span> <span class="pre">logic}</span></code> to a mapper in the form <code class="docutils literal"><span class="pre">{key:</span> <span class="pre">index}</span></code>, where index is
the index needed to slice from data those cases for which logic
was True. This is very useful when checking complicated logic
statements, because it gives you access to the cases that result
from any logical statement.</p>
<div class="section" id="id2">
<h4>Signature/Docstring<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">get_index_mapper</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Convert a {value: logic} map to a {value: index} map.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    This function takes a mapper of {key: logic} entries and resolves</span>
<span class="gp">... </span><span class="sd">    the logic statements using the given meta/data to return a mapper</span>
<span class="gp">... </span><span class="sd">    of {key: index}. The indexes returned can be used on data to isolate</span>
<span class="gp">... </span><span class="sd">    the cases described by arbitrarily complex logical statements.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    meta : dict</span>
<span class="gp">... </span><span class="sd">        Quantipy meta document.</span>
<span class="gp">... </span><span class="sd">    data : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        Data accompanying the given meta document.</span>
<span class="gp">... </span><span class="sd">    mapper : dict</span>
<span class="gp">... </span><span class="sd">        A mapper of {key: logic}</span>
<span class="gp">... </span><span class="sd">    default : str</span>
<span class="gp">... </span><span class="sd">        The column name to default to in cases where unattended lists</span>
<span class="gp">... </span><span class="sd">        are given as logic, where an auto-transformation of {key: list}</span>
<span class="gp">... </span><span class="sd">        to {key: {default: list}} is provided.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    index_mapper : dict</span>
<span class="gp">... </span><span class="sd">        A mapper of {key: index}</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-usage">
<h4>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h4>
<p>The segmentation mapper that was generated in <strong>Example 4</strong> of the article
explaining the <code class="docutils literal"><span class="pre">recode</span></code> function is an example of a set of conditions
that are too complicated to check with a simple crosstab. In these
cases there&#8217;s no way around looking at the data selected by the
logical condition and interrogating it directly to confirm that the
statement has returned what you expect it to.</p>
<p>Assuming the segmentation mapper from that example, you can return
the index mapper like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">index_mapper</span> <span class="o">=</span> <span class="n">get_index_mapper</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mapper</span><span class="p">)</span>
</pre></div>
</div>
<p>Which returns the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">index_mapper</span>
<span class="gp">... </span><span class="p">{</span>
<span class="gp">... </span>  <span class="mi">1</span><span class="p">:</span> <span class="n">Int64Index</span><span class="p">([</span>   <span class="mi">1</span><span class="p">,</span>    <span class="mi">5</span><span class="p">,</span>    <span class="mi">7</span><span class="p">,</span>   <span class="mi">13</span><span class="p">,</span>   <span class="mi">14</span><span class="p">,</span>   <span class="mi">17</span><span class="p">,</span>   <span class="mi">18</span><span class="p">,</span>   <span class="mi">24</span><span class="p">,</span>   <span class="mi">25</span><span class="p">,</span>   <span class="mi">30</span><span class="p">,</span>
<span class="gp">... </span>         <span class="o">...</span>
<span class="gp">... </span>         <span class="mi">2087</span><span class="p">,</span> <span class="mi">2088</span><span class="p">,</span> <span class="mi">2090</span><span class="p">,</span> <span class="mi">2091</span><span class="p">,</span> <span class="mi">2093</span><span class="p">,</span> <span class="mi">2094</span><span class="p">,</span> <span class="mi">2098</span><span class="p">,</span> <span class="mi">2103</span><span class="p">,</span> <span class="mi">2104</span><span class="p">,</span> <span class="mi">2107</span><span class="p">],</span>
<span class="gp">... </span>         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1167</span><span class="p">),</span>
<span class="gp">... </span>  <span class="mi">2</span><span class="p">:</span> <span class="n">Int64Index</span><span class="p">([</span>   <span class="mi">6</span><span class="p">,</span>   <span class="mi">19</span><span class="p">,</span>   <span class="mi">22</span><span class="p">,</span>   <span class="mi">37</span><span class="p">,</span>   <span class="mi">38</span><span class="p">,</span>   <span class="mi">48</span><span class="p">,</span>   <span class="mi">64</span><span class="p">,</span>   <span class="mi">67</span><span class="p">,</span>   <span class="mi">69</span><span class="p">,</span>   <span class="mi">71</span><span class="p">,</span>
<span class="gp">... </span>         <span class="o">...</span>
<span class="gp">... </span>         <span class="mi">2073</span><span class="p">,</span> <span class="mi">2075</span><span class="p">,</span> <span class="mi">2077</span><span class="p">,</span> <span class="mi">2096</span><span class="p">,</span> <span class="mi">2101</span><span class="p">,</span> <span class="mi">2102</span><span class="p">,</span> <span class="mi">2106</span><span class="p">,</span> <span class="mi">2108</span><span class="p">,</span> <span class="mi">2109</span><span class="p">,</span> <span class="mi">2110</span><span class="p">],</span>
<span class="gp">... </span>         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">261</span><span class="p">),</span>
<span class="gp">... </span>  <span class="mi">3</span><span class="p">:</span> <span class="n">Int64Index</span><span class="p">([</span>  <span class="mi">12</span><span class="p">,</span>   <span class="mi">40</span><span class="p">,</span>   <span class="mi">52</span><span class="p">,</span>   <span class="mi">75</span><span class="p">,</span>   <span class="mi">80</span><span class="p">,</span>   <span class="mi">87</span><span class="p">,</span>   <span class="mi">89</span><span class="p">,</span>  <span class="mi">118</span><span class="p">,</span>  <span class="mi">132</span><span class="p">,</span>  <span class="mi">133</span><span class="p">,</span>
<span class="gp">... </span>         <span class="o">...</span>
<span class="gp">... </span>         <span class="mi">1888</span><span class="p">,</span> <span class="mi">1919</span><span class="p">,</span> <span class="mi">1924</span><span class="p">,</span> <span class="mi">1940</span><span class="p">,</span> <span class="mi">1943</span><span class="p">,</span> <span class="mi">1962</span><span class="p">,</span> <span class="mi">1973</span><span class="p">,</span> <span class="mi">1983</span><span class="p">,</span> <span class="mi">2025</span><span class="p">,</span> <span class="mi">2052</span><span class="p">],</span>
<span class="gp">... </span>         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">119</span><span class="p">),</span>
<span class="gp">... </span>  <span class="mi">4</span><span class="p">:</span> <span class="n">Int64Index</span><span class="p">([</span>   <span class="mi">2</span><span class="p">,</span>    <span class="mi">3</span><span class="p">,</span>    <span class="mi">4</span><span class="p">,</span>    <span class="mi">8</span><span class="p">,</span>    <span class="mi">9</span><span class="p">,</span>   <span class="mi">10</span><span class="p">,</span>   <span class="mi">11</span><span class="p">,</span>   <span class="mi">15</span><span class="p">,</span>   <span class="mi">16</span><span class="p">,</span>   <span class="mi">20</span><span class="p">,</span>
<span class="gp">... </span>         <span class="o">...</span>
<span class="gp">... </span>         <span class="mi">2082</span><span class="p">,</span> <span class="mi">2085</span><span class="p">,</span> <span class="mi">2089</span><span class="p">,</span> <span class="mi">2092</span><span class="p">,</span> <span class="mi">2095</span><span class="p">,</span> <span class="mi">2097</span><span class="p">,</span> <span class="mi">2099</span><span class="p">,</span> <span class="mi">2100</span><span class="p">,</span> <span class="mi">2105</span><span class="p">,</span> <span class="mi">2111</span><span class="p">],</span>
<span class="gp">... </span>         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">564</span><span class="p">)</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="inspecting-the-data">
<h4>Inspecting the data<a class="headerlink" href="#inspecting-the-data" title="Permalink to this headline">¶</a></h4>
<p>This can then be used with the pandas.DataFrame.loc[...] indexer in the
following way:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="n">q1_1</span><span class="p">,</span> <span class="n">q1_2</span><span class="p">,</span> <span class="n">q1_3</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index_mapper</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="go">      q1_1    q1_2    q1_3</span>
<span class="go">1        2       2       3</span>
<span class="go">5        2       1       3</span>
<span class="go">7        2       2       4</span>
<span class="go">13       1       2       3</span>
<span class="go">14       2       2       4</span>
<span class="go">17       2       1       4</span>
<span class="go">18       1       2       4</span>
<span class="go">24       2       1       3</span>
<span class="go">25       1       1       3</span>
<span class="go">30       1       1       3</span>
<span class="go">32       2       2       3</span>
<span class="go">36       1       1       3</span>
<span class="go">39       1       1       5</span>
<span class="go">41       2       2       3</span>
<span class="go">42       1       1       4</span>
<span class="go">45       2       2       4</span>
<span class="go">46       1       1       5</span>
<span class="go">47       2       2       4</span>
<span class="go">49       2       2       4</span>
<span class="go">50       2       2       3</span>
<span class="go">51       1       1       5</span>
<span class="go">53       1       1       4</span>
<span class="go">55       2       1       3</span>
<span class="go">57       1       1       4</span>
<span class="go">59       1       1       4</span>
<span class="go">60       1       1       4</span>
<span class="go">62       2       2       3</span>
<span class="go">65       1       1       3</span>
<span class="go">66       2       2       3</span>
<span class="go">73       1       1       3</span>
<span class="gp">... </span>                             <span class="o">...</span>                             <span class="o">...</span>                             <span class="o">...</span>
</pre></div>
</div>
<p>Here we&#8217;re able to verify that the index mapper is returning a slicer
compatible with the logical statement indicated earlier.</p>
</div>
</div>
</div>
<div class="section" id="complex-logic">
<h2>Complex logic<a class="headerlink" href="#complex-logic" title="Permalink to this headline">¶</a></h2>
<p>We saw in <code class="docutils literal"><span class="pre">recode</span></code> <strong>Example 4</strong> how multiple conditions can be
combined using <code class="docutils literal"><span class="pre">union</span></code> or <code class="docutils literal"><span class="pre">intersection</span></code>. As demonstrated by that
example, recode mappers can be arbitrarily nested as long as they are
well-formed.</p>
<div class="section" id="union">
<h3><code class="docutils literal"><span class="pre">union</span></code><a class="headerlink" href="#union" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">union</span></code> takes a list of logical conditions that will be treated with
<strong>or</strong> logic.</p>
<p>Where <strong>any</strong> of logic_A, logic_B <strong>or</strong> logic_C are <code class="docutils literal"><span class="pre">True</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">union</span><span class="p">([</span><span class="n">logic_A</span><span class="p">,</span> <span class="n">logic_B</span><span class="p">,</span> <span class="n">logic_C</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="intersection">
<h3><code class="docutils literal"><span class="pre">intersection</span></code><a class="headerlink" href="#intersection" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">intersection</span></code> takes a list of conditions that will be
treated with  <strong>and</strong> logic.</p>
<p>Where <strong>all</strong> of logic_A, logic_B <strong>and</strong> logic_C are <code class="docutils literal"><span class="pre">True</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">intersection</span><span class="p">([</span><span class="n">logic_A</span><span class="p">,</span> <span class="n">logic_B</span><span class="p">,</span> <span class="n">logic_C</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="list-logic">
<h3>&#8220;list logic&#8221;<a class="headerlink" href="#list-logic" title="Permalink to this headline">¶</a></h3>
<p>All of the value-conditions we&#8217;ve seen so far have used an implied <em>or</em> logic.</p>
<p>For example <code class="docutils literal"><span class="pre">{&quot;q1_1&quot;:</span> <span class="pre">[1,</span> <span class="pre">2]}</span></code> is an example of list-logic, where <code class="docutils literal"><span class="pre">[1,</span> <span class="pre">2]</span></code>
will be interpreted as <code class="docutils literal"><span class="pre">has_any([1,</span> <span class="pre">2])</span></code>, meaning if <strong>q1_1</strong> has any of the
values <strong>1</strong> or <strong>2</strong>.</p>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has any of the responses 1, 2 or 3:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
</pre></div>
</div>
</div>
<div class="section" id="has-any">
<h3><code class="docutils literal"><span class="pre">has_any</span></code><a class="headerlink" href="#has-any" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has any of the responses 1, 2 or 3:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_any</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has any of the responses 1, 2 or 3 and no others:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_any</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="section" id="not-any">
<h3><code class="docutils literal"><span class="pre">not_any</span></code><a class="headerlink" href="#not-any" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have any of the responses 1, 2 or 3:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_any</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have any of the responses 1, 2 or 3 but has some others:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_any</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="section" id="has-all">
<h3><code class="docutils literal"><span class="pre">has_all</span></code><a class="headerlink" href="#has-all" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has all of the responses 1, 2 and 3:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_all</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has all of the responses 1, 2 and 3 and no others:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_all</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="section" id="not-all">
<h3><code class="docutils literal"><span class="pre">not_all</span></code><a class="headerlink" href="#not-all" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have all of the responses 1, 2 and 3:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_all</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have all of the responses 1, 2 and 3 but has some others:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_all</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="section" id="has-count">
<h3><code class="docutils literal"><span class="pre">has_count</span></code><a class="headerlink" href="#has-count" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has exactly 2 responses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_count</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has 1, 2 or 3 responses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_count</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has 1 or more responses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_count</span><span class="p">([</span><span class="n">is_ge</span><span class="p">(</span><span class="mi">1</span><span class="p">)])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has 1, 2 or 3 responses from the response group 5, 6, 7, 8 or 9:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_count</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> has 1 or more responses from the response group 5, 6, 7, 8 or 9:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">has_count</span><span class="p">([</span><span class="n">is_ge</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])}</span>
</pre></div>
</div>
</div>
<div class="section" id="not-count">
<h3><code class="docutils literal"><span class="pre">not_count</span></code><a class="headerlink" href="#not-count" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have exactly 2 responses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_count</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have 1, 2 or 3 responses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_count</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have 1 or more responses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_count</span><span class="p">([</span><span class="n">is_ge</span><span class="p">(</span><span class="mi">1</span><span class="p">)])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have 1, 2 or 3 responses from the response group 5, 6, 7, 8 or 9:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_count</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">q1_1</span></code> doesn&#8217;t have 1 or more responses from the response group 5, 6, 7, 8 or 9:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="n">not_count</span><span class="p">([</span><span class="n">is_ge</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]])}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="instant-aggregations">
<h2>Instant aggregations<a class="headerlink" href="#instant-aggregations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="crosstab">
<h3><code class="docutils literal"><span class="pre">crosstab</span></code><a class="headerlink" href="#crosstab" title="Permalink to this headline">¶</a></h3>
<p>This function uses the given meta and data to create a
type-appropriate cross-tabulation (pivot table) of the named x and y
variables. The result may be either counts or column percentages,
weighted or unweighted.</p>
<div class="section" id="id3">
<h4>Signature/Docstring<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">get</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Return a type-appropriate crosstab of x and y.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    This function uses the given meta and data to create a</span>
<span class="gp">... </span><span class="sd">    type-appropriate cross-tabulation (pivot table) of the named x and y</span>
<span class="gp">... </span><span class="sd">    variables. The result may be either counts or column percentages,</span>
<span class="gp">... </span><span class="sd">    weighted or unweighted.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    meta : dict</span>
<span class="gp">... </span><span class="sd">        Quantipy meta document.</span>
<span class="gp">... </span><span class="sd">    data : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        Data accompanying the given meta document.</span>
<span class="gp">... </span><span class="sd">    x : str</span>
<span class="gp">... </span><span class="sd">        The variable that should be placed into the x-position.</span>
<span class="gp">... </span><span class="sd">    y : str</span>
<span class="gp">... </span><span class="sd">        The variable that should be placed into the y-position.</span>
<span class="gp">... </span><span class="sd">    get : str, default=&#39;count&#39;</span>
<span class="gp">... </span><span class="sd">        Control the type of data that is returned. &#39;count&#39; will return</span>
<span class="gp">... </span><span class="sd">        absolute counts and &#39;normalize&#39; will return column percentages.</span>
<span class="gp">... </span><span class="sd">    decimals : int, default=1</span>
<span class="gp">... </span><span class="sd">        Control the number of decimals in the returned dataframe.</span>
<span class="gp">... </span><span class="sd">    weight : str, default=None</span>
<span class="gp">... </span><span class="sd">        The name of the weight variable that should be used on the data,</span>
<span class="gp">... </span><span class="sd">        if any.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    df : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        The crosstab as a pandas DataFrame.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="setup">
<h4>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h4>
<p>Assuming the following recode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qqincome_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;delimited set&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">901</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;Under £20k (Income group 1)&quot;</span><span class="p">}},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">902</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;£20,000 to £50,000 (Income group 2)&quot;</span><span class="p">}},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">903</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;£50,001 + (Income group 3)&quot;</span><span class="p">}}</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;2-7&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;qincome&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="counts">
<h4>Counts<a class="headerlink" href="#counts" title="Permalink to this headline">¶</a></h4>
<p>You would normally generate a checking pivot between &#8216;qincome&#8217; and
your newly recoded &#8216;qincome_xb&#8217;.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;qincome&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;qincome_xb&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">Question           qincome_xb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2111  427  206  189  146  122  104  92  69  60  232  111  353  427  859  361</span>
<span class="go">            1                 427  427    0    0    0    0    0   0   0   0    0    0    0  427    0    0</span>
<span class="go">            2                 206    0  206    0    0    0    0   0   0   0    0    0    0    0  206    0</span>
<span class="go">            3                 189    0    0  189    0    0    0   0   0   0    0    0    0    0  189    0</span>
<span class="go">            4                 146    0    0    0  146    0    0   0   0   0    0    0    0    0  146    0</span>
<span class="go">            5                 122    0    0    0    0  122    0   0   0   0    0    0    0    0  122    0</span>
<span class="go">            6                 104    0    0    0    0    0  104   0   0   0    0    0    0    0  104    0</span>
<span class="go">            7                  92    0    0    0    0    0    0  92   0   0    0    0    0    0   92    0</span>
<span class="go">            8                  69    0    0    0    0    0    0   0  69   0    0    0    0    0    0   69</span>
<span class="go">            9                  60    0    0    0    0    0    0   0   0  60    0    0    0    0    0   60</span>
<span class="go">            10                232    0    0    0    0    0    0   0   0   0  232    0    0    0    0  232</span>
<span class="go">            11                111    0    0    0    0    0    0   0   0   0    0  111    0    0    0    0</span>
<span class="go">            12                353    0    0    0    0    0    0   0   0   0    0    0  353    0    0    0</span>
</pre></div>
</div>
</div>
<div class="section" id="percentages">
<h4>Percentages<a class="headerlink" href="#percentages" title="Permalink to this headline">¶</a></h4>
<p>You can also request a normalized pivot (using column percentages)
in the following way:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;qincome&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">get</span><span class="o">=</span><span class="s1">&#39;normalize&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">Question           qincome_xb</span>
<span class="go">Values                        All    1    2    3    4    5    6    7    8    9   10   11   12  901    902    903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All             100.0  100  100  100  100  100  100  100  100  100  100  100  100  100  100.0  100.0</span>
<span class="go">            1                20.2  100    0    0    0    0    0    0    0    0    0    0    0  100    0.0    0.0</span>
<span class="go">            2                 9.8    0  100    0    0    0    0    0    0    0    0    0    0    0   24.0    0.0</span>
<span class="go">            3                 9.0    0    0  100    0    0    0    0    0    0    0    0    0    0   22.0    0.0</span>
<span class="go">            4                 6.9    0    0    0  100    0    0    0    0    0    0    0    0    0   17.0    0.0</span>
<span class="go">            5                 5.8    0    0    0    0  100    0    0    0    0    0    0    0    0   14.2    0.0</span>
<span class="go">            6                 4.9    0    0    0    0    0  100    0    0    0    0    0    0    0   12.1    0.0</span>
<span class="go">            7                 4.4    0    0    0    0    0    0  100    0    0    0    0    0    0   10.7    0.0</span>
<span class="go">            8                 3.3    0    0    0    0    0    0    0  100    0    0    0    0    0    0.0   19.1</span>
<span class="go">            9                 2.8    0    0    0    0    0    0    0    0  100    0    0    0    0    0.0   16.6</span>
<span class="go">            10               11.0    0    0    0    0    0    0    0    0    0  100    0    0    0    0.0   64.3</span>
<span class="go">            11                5.3    0    0    0    0    0    0    0    0    0    0  100    0    0    0.0    0.0</span>
<span class="go">            12               16.7    0    0    0    0    0    0    0    0    0    0    0  100    0    0.0    0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-decimals">
<h4>Controlling decimals<a class="headerlink" href="#controlling-decimals" title="Permalink to this headline">¶</a></h4>
<p>And you can control the number of decimals that return to you (the
default being one) using the decimals parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;qincome&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">get</span><span class="o">=</span><span class="s1">&#39;normalize&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">decimals</span><span class="o">=</span><span class="mi">3</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">Question           qincome_xb</span>
<span class="go">Values                        All    1    2    3    4    5    6    7    8    9   10   11   12  901      902      903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All           100.000  100  100  100  100  100  100  100  100  100  100  100  100  100  100.000  100.000</span>
<span class="go">            1              20.227  100    0    0    0    0    0    0    0    0    0    0    0  100    0.000    0.000</span>
<span class="go">            2               9.758    0  100    0    0    0    0    0    0    0    0    0    0    0   23.981    0.000</span>
<span class="go">            3               8.953    0    0  100    0    0    0    0    0    0    0    0    0    0   22.002    0.000</span>
<span class="go">            4               6.916    0    0    0  100    0    0    0    0    0    0    0    0    0   16.997    0.000</span>
<span class="go">            5               5.779    0    0    0    0  100    0    0    0    0    0    0    0    0   14.203    0.000</span>
<span class="go">            6               4.927    0    0    0    0    0  100    0    0    0    0    0    0    0   12.107    0.000</span>
<span class="go">            7               4.358    0    0    0    0    0    0  100    0    0    0    0    0    0   10.710    0.000</span>
<span class="go">            8               3.269    0    0    0    0    0    0    0  100    0    0    0    0    0    0.000   19.114</span>
<span class="go">            9               2.842    0    0    0    0    0    0    0    0  100    0    0    0    0    0.000   16.620</span>
<span class="go">            10             10.990    0    0    0    0    0    0    0    0    0  100    0    0    0    0.000   64.266</span>
<span class="go">            11              5.258    0    0    0    0    0    0    0    0    0    0  100    0    0    0.000    0.000</span>
<span class="go">            12             16.722    0    0    0    0    0    0    0    0    0    0    0  100    0    0.000    0.000</span>
</pre></div>
</div>
</div>
<div class="section" id="weighted-results">
<h4>Weighted results<a class="headerlink" href="#weighted-results" title="Permalink to this headline">¶</a></h4>
<p>You can also return any of these variations weighted by naming a
weight variable with the weight parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;qincome&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">get</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weights_UK18&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">Question           qincome_xb</span>
<span class="go">Values                        All      1       2    3       4       5       6      7      8      9      10      11     12    901     902     903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All           2078.00  448.3  214.24  189  147.55  121.93  107.93  85.48  56.81  53.31  209.15  104.41  339.9  448.3  866.13  319.27</span>
<span class="go">            1              448.30  448.3    0.00    0    0.00    0.00    0.00   0.00   0.00   0.00    0.00    0.00    0.0  448.3    0.00    0.00</span>
<span class="go">            2              214.24    0.0  214.24    0    0.00    0.00    0.00   0.00   0.00   0.00    0.00    0.00    0.0    0.0  214.24    0.00</span>
<span class="go">            3              189.00    0.0    0.00  189    0.00    0.00    0.00   0.00   0.00   0.00    0.00    0.00    0.0    0.0  189.00    0.00</span>
<span class="go">            4              147.55    0.0    0.00    0  147.55    0.00    0.00   0.00   0.00   0.00    0.00    0.00    0.0    0.0  147.55    0.00</span>
<span class="go">            5              121.93    0.0    0.00    0    0.00  121.93    0.00   0.00   0.00   0.00    0.00    0.00    0.0    0.0  121.93    0.00</span>
<span class="go">            6              107.93    0.0    0.00    0    0.00    0.00  107.93   0.00   0.00   0.00    0.00    0.00    0.0    0.0  107.93    0.00</span>
<span class="go">            7               85.48    0.0    0.00    0    0.00    0.00    0.00  85.48   0.00   0.00    0.00    0.00    0.0    0.0   85.48    0.00</span>
<span class="go">            8               56.81    0.0    0.00    0    0.00    0.00    0.00   0.00  56.81   0.00    0.00    0.00    0.0    0.0    0.00   56.81</span>
<span class="go">            9               53.31    0.0    0.00    0    0.00    0.00    0.00   0.00   0.00  53.31    0.00    0.00    0.0    0.0    0.00   53.31</span>
<span class="go">            10             209.15    0.0    0.00    0    0.00    0.00    0.00   0.00   0.00   0.00  209.15    0.00    0.0    0.0    0.00  209.15</span>
<span class="go">            11             104.41    0.0    0.00    0    0.00    0.00    0.00   0.00   0.00   0.00    0.00  104.41    0.0    0.0    0.00    0.00</span>
<span class="go">            12             339.90    0.0    0.00    0    0.00    0.00    0.00   0.00   0.00   0.00    0.00    0.00  339.9    0.0    0.00    0.00</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="frequency">
<h3><code class="docutils literal"><span class="pre">frequency</span></code><a class="headerlink" href="#frequency" title="Permalink to this headline">¶</a></h3>
<p>This function uses the given meta and data to create a
type-appropriate frequency table of the named x variable.
The result may be either counts or column percentages, weighted
or unweighted.</p>
<div class="section" id="id4">
<h4>Signature/Docstring<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">frequency</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Return a type-appropriate frequency of x.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    This function uses the given meta and data to create a</span>
<span class="gp">... </span><span class="sd">    type-appropriate frequency table of the named x variable.</span>
<span class="gp">... </span><span class="sd">    The result may be either counts or column percentages, weighted</span>
<span class="gp">... </span><span class="sd">    or unweighted.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    meta : dict</span>
<span class="gp">... </span><span class="sd">        Quantipy meta document.</span>
<span class="gp">... </span><span class="sd">    data : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        Data accompanying the given meta document.</span>
<span class="gp">... </span><span class="sd">    x : str</span>
<span class="gp">... </span><span class="sd">        The variable that should be placed into the x-position.</span>
<span class="gp">... </span><span class="sd">    kwargs : kwargs</span>
<span class="gp">... </span><span class="sd">        All remaining keyword arguments will be passed along to the</span>
<span class="gp">... </span><span class="sd">        crosstab function.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    f : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        The frequency as a pandas DataFrame.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Setup<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Internally the frequency function automates the crosstab function,
so based on the same recode example given in the crosstab article.</p>
<p>Assuming the following recode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;delimited set&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">901</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;Under £20k (Income group 1)&quot;</span><span class="p">}},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">902</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;£20,000 to £50,000 (Income group 2)&quot;</span><span class="p">}},</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">903</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;£50,001 + (Income group 3)&quot;</span><span class="p">}}</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;2-7&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;qincome&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Counts<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frequency</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome_xb&#39;</span><span class="p">)</span>
<span class="go">Question              qincome_xb</span>
<span class="go">Values                             @</span>
<span class="go">Question       Values</span>
<span class="go">qincome_xb     All              2111</span>
<span class="go">               1                 427</span>
<span class="go">               2                 206</span>
<span class="go">               3                 189</span>
<span class="go">               4                 146</span>
<span class="go">               5                 122</span>
<span class="go">               6                 104</span>
<span class="go">               7                  92</span>
<span class="go">               8                  69</span>
<span class="go">               9                  60</span>
<span class="go">               10                232</span>
<span class="go">               11                111</span>
<span class="go">               12                353</span>
<span class="go">               901               427</span>
<span class="go">               902               859</span>
<span class="go">               903               361</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4>Percentages<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frequency</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span> <span class="n">get</span><span class="o">=</span><span class="s1">&#39;normalize&#39;</span><span class="p">)</span>
<span class="go">Question              qincome_xb</span>
<span class="go">Values                             @</span>
<span class="go">Question       Values</span>
<span class="go">qincome_xb     All             100.0</span>
<span class="go">               1                20.2</span>
<span class="go">               2                 9.8</span>
<span class="go">               3                 9.0</span>
<span class="go">               4                 6.9</span>
<span class="go">               5                 5.8</span>
<span class="go">               6                 4.9</span>
<span class="go">               7                 4.4</span>
<span class="go">               8                 3.3</span>
<span class="go">               9                 2.8</span>
<span class="go">               10               11.0</span>
<span class="go">               11                5.3</span>
<span class="go">               12               16.7</span>
<span class="go">               901              20.2</span>
<span class="go">               902              40.7</span>
<span class="go">               903              17.1</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h4>Controlling decimals<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frequency</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span> <span class="n">get</span><span class="o">=</span><span class="s1">&#39;normalize&#39;</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">Question              qincome_xb</span>
<span class="go">Values                             @</span>
<span class="go">Question       Values</span>
<span class="go">qincome_xb     All           100.000</span>
<span class="go">               1              20.227</span>
<span class="go">               2               9.758</span>
<span class="go">               3               8.953</span>
<span class="go">               4               6.916</span>
<span class="go">               5               5.779</span>
<span class="go">               6               4.927</span>
<span class="go">               7               4.358</span>
<span class="go">               8               3.269</span>
<span class="go">               9               2.842</span>
<span class="go">               10             10.990</span>
<span class="go">               11              5.258</span>
<span class="go">               12             16.722</span>
<span class="go">               901            20.227</span>
<span class="go">               902            40.692</span>
<span class="go">               903            17.101</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>Weighted results<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">frequency</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome_xb&#39;</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weights_UK18&#39;</span><span class="p">)</span>
<span class="go">Question              qincome_xb</span>
<span class="go">Values                             @</span>
<span class="go">Question       Values</span>
<span class="go">qincome_xb     All           2078.00</span>
<span class="go">               1              448.30</span>
<span class="go">               2              214.24</span>
<span class="go">               3              189.00</span>
<span class="go">               4              147.55</span>
<span class="go">               5              121.93</span>
<span class="go">               6              107.93</span>
<span class="go">               7               85.48</span>
<span class="go">               8               56.81</span>
<span class="go">               9               53.31</span>
<span class="go">               10             209.15</span>
<span class="go">               11             104.41</span>
<span class="go">               12             339.90</span>
<span class="go">               901            448.30</span>
<span class="go">               902            866.13</span>
<span class="go">               903            319.27</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="rules">
<h2>Rules<a class="headerlink" href="#rules" title="Permalink to this headline">¶</a></h2>
<p>Rules are ways by which you can control how an aggregation is returned
to you. There are three ways in which this can be done:</p>
<ul class="simple">
<li>Selecting values to be retained and in what order</li>
<li>Sorting values along one of their vectors</li>
<li>Selecting values to be dropped</li>
</ul>
<p>These rules can be applied to either the <code class="docutils literal"><span class="pre">x</span></code> of a <code class="docutils literal"><span class="pre">frequency</span></code> or the
<code class="docutils literal"><span class="pre">x</span></code> and/or <code class="docutils literal"><span class="pre">y</span></code> of a crosstab.</p>
<div class="section" id="structure">
<h3>Structure<a class="headerlink" href="#structure" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">rules</span></code> is an optional object you can provide to any column object
in your meta. The <code class="docutils literal"><span class="pre">rules</span></code> object is a dict with <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> keys
for axis-specific application.</p>
<p>Below the <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> keys in the <code class="docutils literal"><span class="pre">rules</span></code> object can be
instructions under the following keys:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">slicex</span></code>: Selecting values to be retained and in what order</li>
<li><code class="docutils literal"><span class="pre">sortx</span></code>: Sorting values along one of their vectors</li>
<li><code class="docutils literal"><span class="pre">dropx</span></code>: Selecting values to be dropped</li>
</ul>
<p>Internally these three rule objects results in a call to functions of
the same name. The contents of each becomes that function call&#8217;s kwargs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Despite the <code class="docutils literal"><span class="pre">x</span></code> in <code class="docutils literal"><span class="pre">slicex</span></code>, <code class="docutils literal"><span class="pre">sortx</span></code> and <code class="docutils literal"><span class="pre">dropx</span></code>, rules can
be applied to either the <code class="docutils literal"><span class="pre">x</span></code> or <code class="docutils literal"><span class="pre">y</span></code> axes of an aggregation. The
naming convention refers to the fact that these operations are only
performed on the <code class="docutils literal"><span class="pre">x</span></code> axis of their receieved <code class="docutils literal"><span class="pre">dataframe</span></code>. However,
internally, when a <code class="docutils literal"><span class="pre">y</span></code> rule is being applied, the <code class="docutils literal"><span class="pre">dataframe</span></code> is
simply transposed for the duration of the rule&#8217;s application.</p>
</div>
</div>
<div class="section" id="slicex">
<h3><code class="docutils literal"><span class="pre">slicex</span></code><a class="headerlink" href="#slicex" title="Permalink to this headline">¶</a></h3>
<p>Assuming a Quantipy-style view result this function takes an index
slice of df as indicated by values and returns the result.</p>
<div class="section" id="id10">
<h4>Signature/Docstring<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">slicex</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">keep_margins</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Return an index-wise slice of df, keeping margins if desired.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Assuming a Quantipy-style view result this function takes an index</span>
<span class="gp">... </span><span class="sd">    slice of df as indicated by values and returns the result.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    df : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        The dataframe that should be sliced along the index.</span>
<span class="gp">... </span><span class="sd">    values : list-like</span>
<span class="gp">... </span><span class="sd">        A list of index values that should be sliced from df.</span>
<span class="gp">... </span><span class="sd">    keep_margins : bool, default=True</span>
<span class="gp">... </span><span class="sd">        If True and the margins index row exists, it will be kept.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    df : list</span>
<span class="gp">... </span><span class="sd">        The sliced dataframe.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Given the following <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            1                 425  425    0    0    0    0    0   0   0   0    0    0    0  425    0    0</span>
<span class="go">            2                 204    0  204    0    0    0    0   0   0   0    0    0    0    0  204    0</span>
<span class="go">            3                 187    0    0  187    0    0    0   0   0   0    0    0    0    0  187    0</span>
<span class="go">            4                 146    0    0    0  146    0    0   0   0   0    0    0    0    0  146    0</span>
<span class="go">            5                 119    0    0    0    0  119    0   0   0   0    0    0    0    0  119    0</span>
<span class="go">            6                 103    0    0    0    0    0  103   0   0   0    0    0    0    0  103    0</span>
<span class="go">            7                  89    0    0    0    0    0    0  89   0   0    0    0    0    0   89    0</span>
<span class="go">            8                  68    0    0    0    0    0    0   0  68   0    0    0    0    0    0   68</span>
<span class="go">            9                  59    0    0    0    0    0    0   0   0  59    0    0    0    0    0   59</span>
<span class="go">            10                226    0    0    0    0    0    0   0   0   0  226    0    0    0    0  226</span>
<span class="go">            11                101    0    0    0    0    0    0   0   0   0    0  101    0    0    0    0</span>
<span class="go">            12                351    0    0    0    0    0    0   0   0   0    0    0  351    0    0    0</span>
</pre></div>
</div>
<p>Set up the <code class="docutils literal"><span class="pre">slicex</span></code> <code class="docutils literal"><span class="pre">rules</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;slicex&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">]}}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;qincome_cb&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;slicex&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">901</span><span class="p">,</span> <span class="mi">902</span><span class="p">,</span> <span class="mi">903</span><span class="p">]}}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Apply the <code class="docutils literal"><span class="pre">rules</span></code> using <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All   12   10    4    6    2  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  351  226  146  103  204  425  848  353</span>
<span class="go">            1                 425    0    0    0    0    0  425    0    0</span>
<span class="go">            3                 187    0    0    0    0    0    0  187    0</span>
<span class="go">            5                 119    0    0    0    0    0    0  119    0</span>
<span class="go">            7                  89    0    0    0    0    0    0   89    0</span>
<span class="go">            9                  59    0    0    0    0    0    0    0   59</span>
<span class="go">            11                101    0    0    0    0    0    0    0    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            1                 425  425    0    0    0    0    0   0   0   0    0    0    0  425    0    0</span>
<span class="go">            3                 187    0    0  187    0    0    0   0   0   0    0    0    0    0  187    0</span>
<span class="go">            5                 119    0    0    0    0  119    0   0   0   0    0    0    0    0  119    0</span>
<span class="go">            7                  89    0    0    0    0    0    0  89   0   0    0    0    0    0   89    0</span>
<span class="go">            9                  59    0    0    0    0    0    0   0   0  59    0    0    0    0    0   59</span>
<span class="go">            11                101    0    0    0    0    0    0   0   0   0    0  101    0    0    0    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All   12   10    4    6    2  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  351  226  146  103  204  425  848  353</span>
<span class="go">            1                 425    0    0    0    0    0  425    0    0</span>
<span class="go">            2                 204    0    0    0    0  204    0  204    0</span>
<span class="go">            3                 187    0    0    0    0    0    0  187    0</span>
<span class="go">            4                 146    0    0  146    0    0    0  146    0</span>
<span class="go">            5                 119    0    0    0    0    0    0  119    0</span>
<span class="go">            6                 103    0    0    0  103    0    0  103    0</span>
<span class="go">            7                  89    0    0    0    0    0    0   89    0</span>
<span class="go">            8                  68    0    0    0    0    0    0    0   68</span>
<span class="go">            9                  59    0    0    0    0    0    0    0   59</span>
<span class="go">            10                226    0  226    0    0    0    0    0  226</span>
<span class="go">            11                101    0    0    0    0    0    0    0    0</span>
<span class="go">            12                351  351    0    0    0    0    0    0    0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sortx">
<h3><code class="docutils literal"><span class="pre">sortx</span></code><a class="headerlink" href="#sortx" title="Permalink to this headline">¶</a></h3>
<p>This function sorts df, which is assumed to be a Quantipy-style
view result with appropriate index/column structure, using
a given column, while maintaining the position of margins if
they exist, and also optionally fixing certain values at the
bottom of the result without sorting them. Note that nested
variable view results are not yet supported.</p>
<div class="section" id="id11">
<h4>Signature/Docstring<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">sortx</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sort_on</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_weight</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Sort the index of df on a column, keeping margins and fixing values.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    This function sorts df, which is assumed to be a Quantipy-style</span>
<span class="gp">... </span><span class="sd">    view result with appropriate index/column structure, using</span>
<span class="gp">... </span><span class="sd">    a given column, while maintaining the position of margins if</span>
<span class="gp">... </span><span class="sd">    they exist, and also optionally fixing certain values at the</span>
<span class="gp">... </span><span class="sd">    bottom of the result without sorting them. Note that nested</span>
<span class="gp">... </span><span class="sd">    variable view results are not yet supported.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    df : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        The Quantipy-style view result to be sorted</span>
<span class="gp">... </span><span class="sd">    sort_on : str or int, default=&#39;@&#39;</span>
<span class="gp">... </span><span class="sd">        The column (on the innermost level of the column&#39;s</span>
<span class="gp">... </span><span class="sd">        MultiIndex) on which to sort. By default sorting will be</span>
<span class="gp">... </span><span class="sd">        based on the unfiltered frequency of the x variable. No</span>
<span class="gp">... </span><span class="sd">        other sorting targets are currently supported.</span>
<span class="gp">... </span><span class="sd">    ascending : bool, default=False</span>
<span class="gp">... </span><span class="sd">        Sort ascending vs. descending. Default descending for</span>
<span class="gp">... </span><span class="sd">        easier application to MR use cases.</span>
<span class="gp">... </span><span class="sd">    fixed : list-like, default=None</span>
<span class="gp">... </span><span class="sd">        A list of index values that should appear underneath</span>
<span class="gp">... </span><span class="sd">        the sorted index values.</span>
<span class="gp">... </span><span class="sd">    with_weight : None or str, default=&#39;auto&#39;</span>
<span class="gp">... </span><span class="sd">        If not &#39;auto&#39; this is name of the weight that is being used for</span>
<span class="gp">... </span><span class="sd">        the sort. &#39;auto&#39; means that the same weight used in the original</span>
<span class="gp">... </span><span class="sd">        computation is also used in the sort, but this argument provides</span>
<span class="gp">... </span><span class="sd">        the ability to sort a computation done with one weight (or None)</span>
<span class="gp">... </span><span class="sd">        on the results of another weight (or None).</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    df : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        The sorted df.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Given the following <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            1                 425  425    0    0    0    0    0   0   0   0    0    0    0  425    0    0</span>
<span class="go">            2                 204    0  204    0    0    0    0   0   0   0    0    0    0    0  204    0</span>
<span class="go">            3                 187    0    0  187    0    0    0   0   0   0    0    0    0    0  187    0</span>
<span class="go">            4                 146    0    0    0  146    0    0   0   0   0    0    0    0    0  146    0</span>
<span class="go">            5                 119    0    0    0    0  119    0   0   0   0    0    0    0    0  119    0</span>
<span class="go">            6                 103    0    0    0    0    0  103   0   0   0    0    0    0    0  103    0</span>
<span class="go">            7                  89    0    0    0    0    0    0  89   0   0    0    0    0    0   89    0</span>
<span class="go">            8                  68    0    0    0    0    0    0   0  68   0    0    0    0    0    0   68</span>
<span class="go">            9                  59    0    0    0    0    0    0   0   0  59    0    0    0    0    0   59</span>
<span class="go">            10                226    0    0    0    0    0    0   0   0   0  226    0    0    0    0  226</span>
<span class="go">            11                101    0    0    0    0    0    0   0   0   0    0  101    0    0    0    0</span>
<span class="go">            12                351    0    0    0    0    0    0   0   0   0    0    0  351    0    0    0</span>
</pre></div>
</div>
<p>Set up the <code class="docutils literal"><span class="pre">sortx</span></code> <code class="docutils literal"><span class="pre">rules</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;AMA_qqincome&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sortx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]}}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;AMA_qqincome_cb&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sortx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">901</span><span class="p">,</span> <span class="mi">902</span><span class="p">,</span> <span class="mi">903</span><span class="p">],</span> <span class="s1">&#39;ascending&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Apply the <code class="docutils literal"><span class="pre">rules</span></code> using <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All   9   8   7   11    6    5    4    3    2   10   12    1  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  59  68  89  101  103  119  146  187  204  226  351  425  425  848  353</span>
<span class="go">            2                 204   0   0   0    0    0    0    0    0  204    0    0    0    0  204    0</span>
<span class="go">            3                 187   0   0   0    0    0    0    0  187    0    0    0    0    0  187    0</span>
<span class="go">            4                 146   0   0   0    0    0    0  146    0    0    0    0    0    0  146    0</span>
<span class="go">            5                 119   0   0   0    0    0  119    0    0    0    0    0    0    0  119    0</span>
<span class="go">            6                 103   0   0   0    0  103    0    0    0    0    0    0    0    0  103    0</span>
<span class="go">            7                  89   0   0  89    0    0    0    0    0    0    0    0    0    0   89    0</span>
<span class="go">            8                  68   0  68   0    0    0    0    0    0    0    0    0    0    0    0   68</span>
<span class="go">            9                  59  59   0   0    0    0    0    0    0    0    0    0    0    0    0   59</span>
<span class="go">            1                 425   0   0   0    0    0    0    0    0    0    0    0  425  425    0    0</span>
<span class="go">            12                351   0   0   0    0    0    0    0    0    0    0  351    0    0    0    0</span>
<span class="go">            10                226   0   0   0    0    0    0    0    0    0  226    0    0    0    0  226</span>
<span class="go">            11                101   0   0   0  101    0    0    0    0    0    0    0    0    0    0    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            2                 204    0  204    0    0    0    0   0   0   0    0    0    0    0  204    0</span>
<span class="go">            3                 187    0    0  187    0    0    0   0   0   0    0    0    0    0  187    0</span>
<span class="go">            4                 146    0    0    0  146    0    0   0   0   0    0    0    0    0  146    0</span>
<span class="go">            5                 119    0    0    0    0  119    0   0   0   0    0    0    0    0  119    0</span>
<span class="go">            6                 103    0    0    0    0    0  103   0   0   0    0    0    0    0  103    0</span>
<span class="go">            7                  89    0    0    0    0    0    0  89   0   0    0    0    0    0   89    0</span>
<span class="go">            8                  68    0    0    0    0    0    0   0  68   0    0    0    0    0    0   68</span>
<span class="go">            9                  59    0    0    0    0    0    0   0   0  59    0    0    0    0    0   59</span>
<span class="go">            1                 425  425    0    0    0    0    0   0   0   0    0    0    0  425    0    0</span>
<span class="go">            12                351    0    0    0    0    0    0   0   0   0    0    0  351    0    0    0</span>
<span class="go">            10                226    0    0    0    0    0    0   0   0   0  226    0    0    0    0  226</span>
<span class="go">            11                101    0    0    0    0    0    0   0   0   0    0  101    0    0    0    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All   9   8   7   11    6    5    4    3    2   10   12    1  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  59  68  89  101  103  119  146  187  204  226  351  425  425  848  353</span>
<span class="go">            1                 425   0   0   0    0    0    0    0    0    0    0    0  425  425    0    0</span>
<span class="go">            2                 204   0   0   0    0    0    0    0    0  204    0    0    0    0  204    0</span>
<span class="go">            3                 187   0   0   0    0    0    0    0  187    0    0    0    0    0  187    0</span>
<span class="go">            4                 146   0   0   0    0    0    0  146    0    0    0    0    0    0  146    0</span>
<span class="go">            5                 119   0   0   0    0    0  119    0    0    0    0    0    0    0  119    0</span>
<span class="go">            6                 103   0   0   0    0  103    0    0    0    0    0    0    0    0  103    0</span>
<span class="go">            7                  89   0   0  89    0    0    0    0    0    0    0    0    0    0   89    0</span>
<span class="go">            8                  68   0  68   0    0    0    0    0    0    0    0    0    0    0    0   68</span>
<span class="go">            9                  59  59   0   0    0    0    0    0    0    0    0    0    0    0    0   59</span>
<span class="go">            10                226   0   0   0    0    0    0    0    0    0  226    0    0    0    0  226</span>
<span class="go">            11                101   0   0   0  101    0    0    0    0    0    0    0    0    0    0    0</span>
<span class="go">            12                351   0   0   0    0    0    0    0    0    0    0  351    0    0    0    0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When generating chains it may be necessary to sometimes sort views computed
using one weight variable (or none at all) by the results of the same column
weighted with another weight variable (or none at all). An example of this
would be when you&#8217;re showing both weighted and unweighted column bases and
you need to apply column-wise sorting to your chains. In this case you will
need to make sure that you use the <code class="docutils literal"><span class="pre">with_weight</span></code> parameter when sorting
to make sure that ALL sorted results will be sorted exactly the same way,
regardless of their individual results based on their weight.</p>
</div>
</div>
</div>
<div class="section" id="dropx">
<h3><code class="docutils literal"><span class="pre">dropx</span></code><a class="headerlink" href="#dropx" title="Permalink to this headline">¶</a></h3>
<p>Assuming a Quantipy-style view result this function drops index
rows indicated by values and returns the result.</p>
<div class="section" id="id12">
<h4>Signature/Docstring<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">dropx</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    Return df after dropping values from the index.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Assuming a Quantipy-style view result this function drops index</span>
<span class="gp">... </span><span class="sd">    rows indicated by values and returns the result.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Parameters</span>
<span class="gp">... </span><span class="sd">    ----------</span>
<span class="gp">... </span><span class="sd">    df : pandas.DataFrame</span>
<span class="gp">... </span><span class="sd">        The dataframe that should have some index rows dropped.</span>
<span class="gp">... </span><span class="sd">    values : list-like</span>
<span class="gp">... </span><span class="sd">        A list of index values that should be dropped from the index.</span>
<span class="gp">...</span><span class="sd"></span>
<span class="gp">... </span><span class="sd">    Returns</span>
<span class="gp">... </span><span class="sd">    -------</span>
<span class="gp">... </span><span class="sd">    df : list</span>
<span class="gp">... </span><span class="sd">        The edited dataframe.</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Given the following <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            1                 425  425    0    0    0    0    0   0   0   0    0    0    0  425    0    0</span>
<span class="go">            2                 204    0  204    0    0    0    0   0   0   0    0    0    0    0  204    0</span>
<span class="go">            3                 187    0    0  187    0    0    0   0   0   0    0    0    0    0  187    0</span>
<span class="go">            4                 146    0    0    0  146    0    0   0   0   0    0    0    0    0  146    0</span>
<span class="go">            5                 119    0    0    0    0  119    0   0   0   0    0    0    0    0  119    0</span>
<span class="go">            6                 103    0    0    0    0    0  103   0   0   0    0    0    0    0  103    0</span>
<span class="go">            7                  89    0    0    0    0    0    0  89   0   0    0    0    0    0   89    0</span>
<span class="go">            8                  68    0    0    0    0    0    0   0  68   0    0    0    0    0    0   68</span>
<span class="go">            9                  59    0    0    0    0    0    0   0   0  59    0    0    0    0    0   59</span>
<span class="go">            10                226    0    0    0    0    0    0   0   0   0  226    0    0    0    0  226</span>
<span class="go">            11                101    0    0    0    0    0    0   0   0   0    0  101    0    0    0    0</span>
<span class="go">            12                351    0    0    0    0    0    0   0   0   0    0    0  351    0    0    0</span>
</pre></div>
</div>
<p>Set up the <code class="docutils literal"><span class="pre">dropx</span></code> <code class="docutils literal"><span class="pre">rules</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;AMA_qqincome&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dropx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">]}}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;AMA_qqincome_cb&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dropx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">901</span><span class="p">,</span> <span class="mi">902</span><span class="p">,</span> <span class="mi">903</span><span class="p">]}}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Apply the <code class="docutils literal"><span class="pre">rules</span></code> using <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    3    5   7   8   9   11</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  187  119  89  68  59  101</span>
<span class="go">            2                 204    0    0    0   0   0   0    0</span>
<span class="go">            4                 146    0    0    0   0   0   0    0</span>
<span class="go">            6                 103    0    0    0   0   0   0    0</span>
<span class="go">            8                  68    0    0    0   0  68   0    0</span>
<span class="go">            10                226    0    0    0   0   0   0    0</span>
<span class="go">            12                351    0    0    0   0   0   0    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            2                 204    0  204    0    0    0    0   0   0   0    0    0    0    0  204    0</span>
<span class="go">            4                 146    0    0    0  146    0    0   0   0   0    0    0    0    0  146    0</span>
<span class="go">            6                 103    0    0    0    0    0  103   0   0   0    0    0    0    0  103    0</span>
<span class="go">            8                  68    0    0    0    0    0    0   0  68   0    0    0    0    0    0   68</span>
<span class="go">            10                226    0    0    0    0    0    0   0   0   0  226    0    0    0    0  226</span>
<span class="go">            12                351    0    0    0    0    0    0   0   0   0    0    0  351    0    0    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    3    5   7   8   9   11</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  187  119  89  68  59  101</span>
<span class="go">            1                 425  425    0    0   0   0   0    0</span>
<span class="go">            2                 204    0    0    0   0   0   0    0</span>
<span class="go">            3                 187    0  187    0   0   0   0    0</span>
<span class="go">            4                 146    0    0    0   0   0   0    0</span>
<span class="go">            5                 119    0    0  119   0   0   0    0</span>
<span class="go">            6                 103    0    0    0   0   0   0    0</span>
<span class="go">            7                  89    0    0    0  89   0   0    0</span>
<span class="go">            8                  68    0    0    0   0  68   0    0</span>
<span class="go">            9                  59    0    0    0   0   0  59    0</span>
<span class="go">            10                226    0    0    0   0   0   0    0</span>
<span class="go">            11                101    0    0    0   0   0   0  101</span>
<span class="go">            12                351    0    0    0   0   0   0    0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="combinations">
<h3>Combinations<a class="headerlink" href="#combinations" title="Permalink to this headline">¶</a></h3>
<p>Any or all of these rules can be used in combination with each other.</p>
<p>Given the following <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            1                 425  425    0    0    0    0    0   0   0   0    0    0    0  425    0    0</span>
<span class="go">            2                 204    0  204    0    0    0    0   0   0   0    0    0    0    0  204    0</span>
<span class="go">            3                 187    0    0  187    0    0    0   0   0   0    0    0    0    0  187    0</span>
<span class="go">            4                 146    0    0    0  146    0    0   0   0   0    0    0    0    0  146    0</span>
<span class="go">            5                 119    0    0    0    0  119    0   0   0   0    0    0    0    0  119    0</span>
<span class="go">            6                 103    0    0    0    0    0  103   0   0   0    0    0    0    0  103    0</span>
<span class="go">            7                  89    0    0    0    0    0    0  89   0   0    0    0    0    0   89    0</span>
<span class="go">            8                  68    0    0    0    0    0    0   0  68   0    0    0    0    0    0   68</span>
<span class="go">            9                  59    0    0    0    0    0    0   0   0  59    0    0    0    0    0   59</span>
<span class="go">            10                226    0    0    0    0    0    0   0   0   0  226    0    0    0    0  226</span>
<span class="go">            11                101    0    0    0    0    0    0   0   0   0    0  101    0    0    0    0</span>
<span class="go">            12                351    0    0    0    0    0    0   0   0   0    0    0  351    0    0    0</span>
</pre></div>
</div>
<p>Set up the <code class="docutils literal"><span class="pre">rules</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;AMA_qqincome&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="go">    &#39;x&#39;: {</span>
<span class="go">        &#39;slicex&#39;: {&#39;values&#39;: [1, 3, 5, 7, 9, 11]},</span>
<span class="go">        &#39;sortx&#39;: {&#39;fixed&#39;: [7]},</span>
<span class="go">        &#39;dropx&#39;: {&#39;values&#39;: [9, 11]}</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;AMA_qqincome_cb&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="go">    &#39;y&#39;: {</span>
<span class="go">        &#39;slicex&#39;: {&#39;values&#39;: [12, 10, 4, 6, 2, 901, 902, 903]},</span>
<span class="go">        &#39;sortx&#39;: {&#39;fixed&#39;: [901, 902, 903], &#39;ascending&#39;: True},</span>
<span class="go">        &#39;dropx&#39;: {&#39;values&#39;: [10]}</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Apply the <code class="docutils literal"><span class="pre">rules</span></code> using <code class="docutils literal"><span class="pre">crosstab</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    6    4    2   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  103  146  204  351  425  848  353</span>
<span class="go">            1                 425    0    0    0    0  425    0    0</span>
<span class="go">            3                 187    0    0    0    0    0  187    0</span>
<span class="go">            5                 119    0    0    0    0    0  119    0</span>
<span class="go">            7                  89    0    0    0    0    0   89    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    1    2    3    4    5    6   7   8   9   10   11   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  425  204  187  146  119  103  89  68  59  226  101  351  425  848  353</span>
<span class="go">            1                 425  425    0    0    0    0    0   0   0   0    0    0    0  425    0    0</span>
<span class="go">            3                 187    0    0  187    0    0    0   0   0   0    0    0    0    0  187    0</span>
<span class="go">            5                 119    0    0    0    0  119    0   0   0   0    0    0    0    0  119    0</span>
<span class="go">            7                  89    0    0    0    0    0    0  89   0   0    0    0    0    0   89    0</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crosstab</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;qincome&#39;</span><span class="p">,</span> <span class="s1">&#39;qincome_cb&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="go">Question               qincome_cb</span>
<span class="go">Values                        All    6    4    2   12  901  902  903</span>
<span class="go">Question    Values</span>
<span class="go">qincome     All              2078  103  146  204  351  425  848  353</span>
<span class="go">            1                 425    0    0    0    0  425    0    0</span>
<span class="go">            2                 204    0    0  204    0    0  204    0</span>
<span class="go">            3                 187    0    0    0    0    0  187    0</span>
<span class="go">            4                 146    0  146    0    0    0  146    0</span>
<span class="go">            5                 119    0    0    0    0    0  119    0</span>
<span class="go">            6                 103  103    0    0    0    0  103    0</span>
<span class="go">            7                  89    0    0    0    0    0   89    0</span>
<span class="go">            8                  68    0    0    0    0    0    0   68</span>
<span class="go">            9                  59    0    0    0    0    0    0   59</span>
<span class="go">            10                226    0    0    0    0    0    0  226</span>
<span class="go">            11                101    0    0    0    0    0    0    0</span>
<span class="go">            12                351    0    0    0  351    0    0    0</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Quantipy dev team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/custom.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>