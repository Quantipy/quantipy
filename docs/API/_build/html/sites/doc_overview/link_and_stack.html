<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Links and Stack &mdash; Quantipy 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Quantipy 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Documentation" href="overview.html" />
    <link rel="next" title="quantify aggregation engine" href="aggregations.html" />
    <link rel="prev" title="Case weight computation" href="weighting.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="aggregations.html" title="quantify aggregation engine"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="weighting.html" title="Case weight computation"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Quantipy 0.1.0 documentation</a> &raquo;</li>
          <li><a href="overview.html" accesskey="U">Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="links-and-stack">
<h1>Links and Stack<a class="headerlink" href="#links-and-stack" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line"><a class="reference internal" href="../../genindex.html"><em>Index</em></a></div>
<div class="line"><a class="reference internal" href="../../py-modindex.html"><em>Module Index</em></a></div>
</div>
<hr class="docutils" />
<div class="section" id="relationships-between-variables">
<h2>Relationships between variables<a class="headerlink" href="#relationships-between-variables" title="Permalink to this headline">¶</a></h2>
<p>Quantipy provides the <tt class="docutils literal"><span class="pre">quantipy.Stack</span></tt> object that serves as a container
for bulk analysis results. The Stack is a nested dictionary for which the
different levels represent <em>requested</em> relationships between pairs of variables
(<tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt>) in the source data, held in <tt class="docutils literal"><span class="pre">quantipy.Link</span></tt> objects.</p>
<p>A Stack dictionary&#8217;s key hierarchy, with regard to its Link defintions, can
be summarized as:</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">[data_key][filter_key][x_key][y_key]</span></tt></div></blockquote>
<p>and is the collection of all Links specified prior or during the data
aggregation process.</p>
<div class="section" id="setting-up-a-stack">
<h3>Setting up a Stack<a class="headerlink" href="#setting-up-a-stack" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><tt class="docutils literal"><span class="pre">quantipy.Stack.add_data(data_key,</span> <span class="pre">meta=None,</span> <span class="pre">data=None)</span></tt></td>
</tr>
</tbody>
</table>
<p>All data analysis performed in Quantipy relies on the <tt class="docutils literal"><span class="pre">Stack</span></tt> object which
must at least be provided with a case data source of type <tt class="docutils literal"><span class="pre">pandas.DataFrame</span></tt>
that is associated with a unique data key. The data key is used as a reference
name for the underlying data file when working with the <tt class="docutils literal"><span class="pre">Stack</span></tt> instance and
constitutes the structure&#8217;s first level. Adding a data source is done using
<tt class="docutils literal"><span class="pre">add_data()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_data_key</span> <span class="o">=</span> <span class="s">&#39;Quantipy example&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path_data</span> <span class="o">=</span> <span class="s">&#39;/Quantipy Example Data/Example Data (A).csv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">dp</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_csv</span><span class="p">(</span><span class="n">path_data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Stack</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data_key</span><span class="o">=</span><span class="n">my_data_key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">)</span>
</pre></div>
</div>
<p>The last two lines of the above example can also be written in the more
compact form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;data_key&#39;</span><span class="p">:</span> <span class="n">my_data_key</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">my_data</span><span class="p">})</span>
</pre></div>
</div>
<p>Now is possible to access the Stack&#8217;s <tt class="docutils literal"><span class="pre">data</span></tt> property which holds the
<tt class="docutils literal"><span class="pre">pandas.DataFrame</span></tt> representation of the case data file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="s">&#39;q5_1&#39;</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">       q5_1  gender</span>
<span class="go">id_L1</span>
<span class="go">1         2       1</span>
<span class="go">2         5       2</span>
<span class="go">3         5       1</span>
<span class="go">4         5       1</span>
<span class="go">5        98       1</span>
</pre></div>
</div>
<p>This basic setup implicitly adds the second level of the Stack structure
as well by indicating that the data is not filtered:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;no_filter&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-to-the-stack">
<h3>Adding to the Stack<a class="headerlink" href="#adding-to-the-stack" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><tt class="docutils literal"><span class="pre">quantipy.Stack.add_link(data_keys=None,</span> <span class="pre">filters=['no_filter'],</span> <span class="pre">x=None,</span>
<span class="pre">y=None,</span> <span class="pre">views=None,</span> <span class="pre">weights=None,</span> <span class="pre">variables=None)</span></tt></td>
</tr>
</tbody>
</table>
<p>It is now possible to start growing the Stack using <tt class="docutils literal"><span class="pre">add_link()</span></tt>, a method
that can be used in a few different ways. This section deals with its
<tt class="docutils literal"><span class="pre">filters</span></tt>, <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt> parameters.</p>
<p><tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt> refer to the defintions of <tt class="docutils literal"><span class="pre">quantipy.Link</span></tt> objects, a linking
of variables to each other. The most basic expression of these links is in the
form of a cross-tabulation or pivot table (since quantifying the relationship
between variables involves aggregating it). x and y refer to the row and column
items of such a table, respectively.</p>
<p>Defining relationships between variables that might be
analyzed later on is as easy as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;q8&#39;</span><span class="p">,</span> <span class="s">&#39;q5_1&#39;</span><span class="p">,</span> <span class="s">&#39;q6_1&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;@&#39;</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Note the special <tt class="docutils literal"><span class="pre">`&#64;`</span></tt>-&#8220;variable&#8221; in the list passed for <tt class="docutils literal"><span class="pre">y</span></tt> parameter: It
instructs the creation of a <em>total</em> Link, i.e. a Link for each variable in the
list for <tt class="docutils literal"><span class="pre">x</span></tt> without a relationship to a <tt class="docutils literal"><span class="pre">y</span></tt> variable. By creating the
Links for between x and y, <tt class="docutils literal"><span class="pre">add_link()</span></tt> adds the third and fourth level to
the Stack:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;q8&#39;, &#39;q5_1&#39;, &#39;q6_1&#39;]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">][</span><span class="s">&#39;q5_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;@&#39;, &#39;age&#39;, &#39;gender&#39;]</span>
</pre></div>
</div>
<p>Using the <tt class="docutils literal"><span class="pre">filters</span></tt> parameter, the Links can be created for  specific
portions of the case data individually. The filter expression must be a string
valid for the  <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.query.html">pandas DataFrame.query()</a>
method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;gender==1&#39;</span><span class="p">,</span> <span class="s">&#39;gender==2&#39;</span><span class="p">],</span>
<span class="gp">... </span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;q8&#39;</span><span class="p">,</span> <span class="s">&#39;q5_1&#39;</span><span class="p">,</span> <span class="s">&#39;q6_1&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;@&#39;</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;gender==1&#39;, &#39;gender==2&#39;, &#39;no_filter&#39;]</span>
</pre></div>
</div>
<p>Looking at the <tt class="docutils literal"><span class="pre">data</span></tt> property at the filter level of the Stack shows the
filtered case data accordingly now:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">][</span><span class="s">&#39;gender==1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="go">1    3952</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">][</span><span class="s">&#39;gender==2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="go">2    4303</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="p">[</span><span class="n">my_data_key</span><span class="p">][</span><span class="s">&#39;no_filter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="go">2    4303</span>
<span class="go">1    3952</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
</div>
<div class="section" id="what-s-inside-a-stack">
<h3>What&#8217;s inside a Stack?<a class="headerlink" href="#what-s-inside-a-stack" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><tt class="docutils literal"><span class="pre">quantipy.Stack.describe(index=None,</span> <span class="pre">columns=None,</span> <span class="pre">query=None,</span>
<span class="pre">split_view_names=False)</span></tt></td>
</tr>
</tbody>
</table>
<p>Given its nested structure and the potentially vast amount Links
specified, inspecting a Stack by asking for its <tt class="docutils literal"><span class="pre">keys()</span></tt> and <tt class="docutils literal"><span class="pre">values()</span></tt>
does not appear as a practical solution. Hence, the Stack&#8217;s <tt class="docutils literal"><span class="pre">describe()</span></tt>
method is the main tool to get quick access to summaries of its contents in
form of a <tt class="docutils literal"><span class="pre">pandas.DataFrame</span></tt>, internally created using the <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.pivot_table.html">pivot_table()
method</a>.
Without any of its parameters specified, the method will show a simple
overview of a Stack&#8217;s defining structural elements, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="go">                data     filter     x       y  view  #</span>
<span class="go">0   Quantipy example  gender==1    q8       @   NaN  1</span>
<span class="go">1   Quantipy example  gender==1    q8     age   NaN  1</span>
<span class="go">2   Quantipy example  gender==1    q8  gender   NaN  1</span>
<span class="go">3   Quantipy example  gender==1  q5_1       @   NaN  1</span>
<span class="go">4   Quantipy example  gender==1  q5_1     age   NaN  1</span>
<span class="go">5   Quantipy example  gender==1  q5_1  gender   NaN  1</span>
<span class="go">6   Quantipy example  gender==1  q6_1       @   NaN  1</span>
<span class="go">7   Quantipy example  gender==1  q6_1     age   NaN  1</span>
<span class="go">8   Quantipy example  gender==1  q6_1  gender   NaN  1</span>
<span class="go">9   Quantipy example  gender==2    q8       @   NaN  1</span>
<span class="go">10  Quantipy example  gender==2    q8     age   NaN  1</span>
<span class="go">11  Quantipy example  gender==2    q8  gender   NaN  1</span>
<span class="go">12  Quantipy example  gender==2  q5_1       @   NaN  1</span>
<span class="go">13  Quantipy example  gender==2  q5_1     age   NaN  1</span>
<span class="go">14  Quantipy example  gender==2  q5_1  gender   NaN  1</span>
<span class="go">15  Quantipy example  gender==2  q6_1       @   NaN  1</span>
<span class="go">16  Quantipy example  gender==2  q6_1     age   NaN  1</span>
<span class="go">17  Quantipy example  gender==2  q6_1  gender   NaN  1</span>
<span class="go">18  Quantipy example  no_filter    q8       @   NaN  1</span>
<span class="go">19  Quantipy example  no_filter    q8     age   NaN  1</span>
<span class="go">20  Quantipy example  no_filter    q8  gender   NaN  1</span>
<span class="go">21  Quantipy example  no_filter  q5_1       @   NaN  1</span>
<span class="go">22  Quantipy example  no_filter  q5_1     age   NaN  1</span>
<span class="go">23  Quantipy example  no_filter  q5_1  gender   NaN  1</span>
<span class="go">24  Quantipy example  no_filter  q6_1       @   NaN  1</span>
<span class="go">25  Quantipy example  no_filter  q6_1     age   NaN  1</span>
<span class="go">26  Quantipy example  no_filter  q6_1  gender   NaN  1</span>
</pre></div>
</div>
<p>Defining the <tt class="docutils literal"><span class="pre">index</span></tt> and/or <tt class="docutils literal"><span class="pre">columns</span></tt> parameters allows to show (nested)
structures:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">])</span>
<span class="go">y     @  age  gender</span>
<span class="go">x</span>
<span class="go">q5_1  3    3       3</span>
<span class="go">q6_1  3    3       3</span>
<span class="go">q8    3    3       3</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="o">&gt;&gt;&gt;</span> <span class="n">stack</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;filter&#39;</span><span class="p">])</span>
<span class="go">filter       gender==1  gender==2  no_filter</span>
<span class="go">x    y</span>
<span class="go">q5_1 @               1          1          1</span>
<span class="go">     age             1          1          1</span>
<span class="go">     gender          1          1          1</span>
<span class="go">q6_1 @               1          1          1</span>
<span class="go">     age             1          1          1</span>
<span class="go">     gender          1          1          1</span>
<span class="go">q8   @               1          1          1</span>
<span class="go">     age             1          1          1</span>
<span class="go">     gender          1          1          1</span>
</pre></div>
</div>
<p>or elements in isolation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">])</span>
<span class="go">x</span>
<span class="go">q5_1    9</span>
<span class="go">q6_1    9</span>
<span class="go">q8      9</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="working-with-metadata">
<h2>Working with metadata<a class="headerlink" href="#working-with-metadata" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><tt class="docutils literal"><span class="pre">quantipy.Stack.add_data(data_key,</span> <span class="pre">meta=None,</span> <span class="pre">data=None)</span></tt></td>
</tr>
<tr class="field-even field"><th class="field-name">method:</th><td class="field-body"><tt class="docutils literal"><span class="pre">quantipy.Stack.variable_types(data_key,</span> <span class="pre">only_type=None)</span></tt></td>
</tr>
</tbody>
</table>
<p>One of Quantipy&#8217;s key features is the inclusion of metadata that describes
the raw case data file&#8217;s content and structure. Metadata can take many forms,
examples include:</p>
<ul>
<li><dl class="first docutils">
<dt>Global information on data sources</dt>
<dd><ul class="first last simple">
<li>project names</li>
<li>project dates</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Variable and value labels</dt>
<dd><ul class="first last simple">
<li>question texts</li>
<li>explanatory information on a variable</li>
<li>meaning of categorical codes in discrete variables</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Instructions on how data is interpreted</dt>
<dd><ul class="first last simple">
<li>numeric: float, int</li>
<li>categorical: single- or multi-coded</li>
<li>how is a collection of values understood generally? categorical vs.
numeric interpretation</li>
<li>date, text, etc.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Information on data structures of higher orders</dt>
<dd><ul class="first last simple">
<li>item batteries, grid-like data</li>
<li>hierarchical data</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Information on special value codes</dt>
<dd><ul class="first last simple">
<li>residual categories and <em>missing data</em> indicators</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Considering that a main purpose of the Stack object is the automation of data
aggregation and reporting, file metadata acts an useful source of  gathering
instructions on how data is understood, processed and exported. The
<tt class="docutils literal"><span class="pre">add_data()</span></tt> method therefore can pick up a Quantipy compatible metadata
file and store it alongside the related case data by specifying it in the
<tt class="docutils literal"><span class="pre">meta</span></tt> parameter. Building on the example above, we can enrich our Stack
with metadata as per:</p>
<p><em>Defining the data key and loading the case data</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_data_key</span> <span class="o">=</span> <span class="s">&#39;Quantipy example&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path_data</span> <span class="o">=</span> <span class="s">&#39;/Quantipy Example Data/Example Data (A).csv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">dp</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_csv</span><span class="p">(</span><span class="n">path_data</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Loading the associated metadata file</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">path_meta</span> <span class="o">=</span> <span class="s">&#39;/Quantipy Example Data/Example Data (A).json&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_meta</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">dp</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">path_meta</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Adding both case data and metadata to the Stack</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Stack</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data_key</span><span class="o">=</span><span class="n">my_data_key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">my_data</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">my_meta</span><span class="p">)</span>
</pre></div>
</div>
<p>With <tt class="docutils literal"><span class="pre">my_meta</span></tt> assigned to the <tt class="docutils literal"><span class="pre">meta</span></tt> property, the Stack now has access to
the complete collection of meta information on the source case data. This allows
to conveniently collect information on the variable types , using
<tt class="docutils literal"><span class="pre">variable_types()</span></tt> method, e.g. in order to choose appropriate aggregation
methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">variable_types</span><span class="p">(</span><span class="n">my_data_key</span><span class="p">)</span>
<span class="go">{&#39;date&#39;: [&#39;start_time&#39;, &#39;end_time&#39;],</span>
<span class="go"> &#39;single&#39;: [&#39;gender&#39;, &#39;locality&#39;, &#39;ethnicity&#39;, &#39;religion&#39;, &#39;q1&#39;, &#39;q2b&#39;, &#39;q4&#39;,</span>
<span class="go"> &#39;q5_1&#39;, &#39;q5_2&#39;, &#39;q5_3&#39;, &#39;q5_4&#39;, &#39;q5_5&#39;, &#39;q5_6&#39;, &#39;q6_1&#39;, &#39;q6_2&#39;, &#39;q6_3&#39;, &#39;q7_1&#39;,</span>
<span class="go"> &#39;q7_2&#39;, &#39;q7_3&#39;, &#39;q7_4&#39;, &#39;q7_5&#39;, &#39;q7_6&#39;, &#39;Wave&#39;],</span>
<span class="go"> &#39;string&#39;: [&#39;q8a&#39;, &#39;q9a&#39;],</span>
<span class="go"> &#39;time&#39;: [&#39;duration&#39;],</span>
<span class="go"> &#39;int&#39;: [&#39;record_number&#39;, &#39;unique_id&#39;, &#39;age&#39;, &#39;birth_day&#39;, &#39;birth_month&#39;,</span>
<span class="go"> &#39;birth_year&#39;],</span>
<span class="go"> &#39;array&#39;: [u&#39;q5&#39;, u&#39;q7&#39;, u&#39;q6&#39;],</span>
<span class="go"> &#39;float&#39;: [&#39;weight&#39;, &#39;weight_a&#39;, &#39;weight_b&#39;],</span>
<span class="go"> &#39;delimited set&#39;: [&#39;q2&#39;, &#39;q3&#39;, &#39;q8&#39;, &#39;q9&#39;]}</span>
</pre></div>
</div>
<p>When only specific types of data are of interest, the <tt class="docutils literal"><span class="pre">only_type</span></tt> parameter
can be used to reduce the output to, for instance, show only multi-coded
variables (<em>delimited sets</em>) found in the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">variable_types</span><span class="p">(</span><span class="n">my_data_key</span><span class="p">,</span> <span class="n">only_type</span><span class="o">=</span><span class="s">&#39;delimited set&#39;</span><span class="p">)</span>
<span class="go">[&#39;q2&#39;, &#39;q3&#39;, &#39;q8&#39;, &#39;q9&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-multiple-data-sources">
<h2>Working with multiple data sources<a class="headerlink" href="#working-with-multiple-data-sources" title="Permalink to this headline">¶</a></h2>
<p>It is possible to attach multiple file sources to a Stack by simply assigning
them to unique data keys. If we use our inital Stack, we can add another
source via <tt class="docutils literal"><span class="pre">add_data()</span></tt>:</p>
<p><em>Setting up the file paths &amp; loading data</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">my_other_data_key</span> <span class="o">=</span> <span class="s">&#39;Other casedata&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path_other_data</span> <span class="o">=</span> <span class="s">&#39;/Quantipy Example Data/engine_B_data.csv&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">path_other_meta</span> <span class="o">=</span> <span class="s">&#39;/Quantipy Example Data/engine_B_meta.json&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_other_data</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">dp</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_csv</span><span class="p">(</span><span class="n">path_other_data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_other_meta</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">dp</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_json</span><span class="p">(</span><span class="n">path_other_meta</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Adding the data to the Stack</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data_key</span><span class="o">=</span><span class="n">my_other_data_key</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">data</span><span class="o">=</span><span class="n">my_other_data</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">meta</span><span class="o">=</span><span class="n">my_other_meta</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Creating Links (taking the correct data key into account)</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">data_keys</span><span class="o">=</span><span class="n">my_other_data_key</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;cost_dinner&#39;</span><span class="p">,</span> <span class="s">&#39;q4&#39;</span><span class="p">],</span>
<span class="gp">... </span>               <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;profile_gender&#39;</span><span class="p">,</span> <span class="s">&#39;age_group&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p><em>Stack content</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="s">&#39;filter&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">])</span>
<span class="go">x                          cost_dinner                       q4                q5_1            q6_1             q8</span>
<span class="go">y                            age_group profile_gender age_group profile_gender    @ age gender    @ age gender   @ age gender</span>
<span class="go">data             filter</span>
<span class="go">Another file     no_filter           1              1         1              1  NaN NaN    NaN  NaN NaN    NaN NaN NaN    NaN</span>
<span class="go">Quantipy example gender==1         NaN            NaN       NaN            NaN    1   1      1    1   1      1   1   1      1</span>
<span class="go">                 gender==2         NaN            NaN       NaN            NaN    1   1      1    1   1      1   1   1      1</span>
<span class="go">                 no_filter         NaN            NaN       NaN            NaN    1   1      1    1   1      1   1   1      1</span>
</pre></div>
</div>
<p>A Stack instance can also be called directly with the <tt class="docutils literal"><span class="pre">add_data</span></tt> parameter
that can handle dicts of tuples or dicts structuring the data keys and input
file pairs. Instead of using two subsequent calls to the <tt class="docutils literal"><span class="pre">add_data()</span></tt> method,
the following two examples establish the same input data conections as before:</p>
<p><em>dict type structure</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>             <span class="n">my_data_key</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">my_data</span><span class="p">,</span> <span class="s">&#39;meta&#39;</span><span class="p">:</span> <span class="n">my_meta</span><span class="p">},</span>
<span class="gp">... </span>             <span class="n">my_other_data_key</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">my_other_data</span><span class="p">,</span> <span class="s">&#39;meta&#39;</span><span class="p">:</span> <span class="n">my_other_meta</span><span class="p">}</span>
<span class="gp">... </span>            <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="n">data_dict</span><span class="p">)</span>
</pre></div>
</div>
<p><em>tuple type structure</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data_tuple</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>              <span class="n">my_data_key</span><span class="p">:</span> <span class="p">(</span><span class="n">my_data</span><span class="p">,</span> <span class="n">my_meta</span><span class="p">),</span>
<span class="gp">... </span>              <span class="n">my_other_data_key</span><span class="p">:</span> <span class="p">(</span><span class="n">my_other_data</span><span class="p">,</span> <span class="n">my_other_meta</span><span class="p">)</span>
<span class="gp">... </span>             <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="n">data_tuple</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>To stress it again</strong>, when adding Links to the Stack, we now need to
consider the appropriate data keys in order to target the matching input data
for our filters and x/y-axis variables. If we simply try to generate the
original Links on our new multiple sources holding Stack, we will run into an
error since not all variables are found in both files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;q8&#39;</span><span class="p">,</span> <span class="s">&#39;q5_1&#39;</span><span class="p">,</span> <span class="s">&#39;q6_1&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;@&#39;</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">])</span>
<span class="go">ValueError: for data key: Another file</span>
<span class="go">x=[&#39;q8&#39;, &#39;q5_1&#39;, &#39;q6_1&#39;] not found, y=[&#39;gender&#39;] not found.</span>
</pre></div>
</div>
<p>Therefore, we define the <tt class="docutils literal"><span class="pre">data_key</span></tt> parameter explicitely...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">data_keys</span><span class="o">=</span><span class="n">my_data_key</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;no_filter&#39;</span><span class="p">,</span> <span class="s">&#39;gender==1&#39;</span><span class="p">,</span> <span class="s">&#39;gender==2&#39;</span><span class="p">]</span>
<span class="gp">... </span>               <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;q8&#39;</span><span class="p">,</span> <span class="s">&#39;q5_1&#39;</span><span class="p">,</span> <span class="s">&#39;q6_1&#39;</span><span class="p">],</span>
<span class="gp">... </span>               <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;@&#39;</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">data_keys</span><span class="o">=</span><span class="n">my_other_data_key</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;cost_dinner&#39;</span><span class="p">,</span> <span class="s">&#39;q4&#39;</span><span class="p">],</span>
<span class="gp">... </span>               <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;profile_gender&#39;</span><span class="p">,</span> <span class="s">&#39;age_group&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>... and end up with the correct Links:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="s">&#39;filter&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">])</span>
<span class="go">x                          cost_dinner                       q4                q5_1            q6_1             q8</span>
<span class="go">y                            age_group profile_gender age_group profile_gender    @ age gender    @ age gender   @ age gender</span>
<span class="go">data             filter</span>
<span class="go">Another file     no_filter           1              1         1              1  NaN NaN    NaN  NaN NaN    NaN NaN NaN    NaN</span>
<span class="go">Quantipy example gender==1         NaN            NaN       NaN            NaN    1   1      1    1   1      1   1   1      1</span>
<span class="go">                 gender==2         NaN            NaN       NaN            NaN    1   1      1    1   1      1   1   1      1</span>
<span class="go">                 no_filter         NaN            NaN       NaN            NaN    1   1      1    1   1      1   1   1      1</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">Quantipy</h2>
    
  </a>
</p>







<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What&#8217;s new?</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="io.html">Data sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_preparation.html">Data preparation / recoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="weighting.html">Case weight computation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Links and Stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#relationships-between-variables">Relationships between variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-a-stack">Setting up a Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-to-the-stack">Adding to the Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-s-inside-a-stack">What&#8217;s inside a Stack?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#working-with-metadata">Working with metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-with-multiple-data-sources">Working with multiple data sources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="aggregations.html"><tt class="docutils literal"><span class="pre">quantify</span></tt> aggregation engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_concept_notation.html">View concept introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="views_freq_desc.html">View method manipulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sigtesting_onf_view.html">Signficance testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="chain_cluster_build.html">Extraction and Exports</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Quantipy dev team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.3</a>
      
      |
      <a href="../../_sources/sites/doc_overview/link_and_stack.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>