

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Custom data recoding &mdash; Quantipy 0.1.3 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Quantipy 0.1.3 documentation" href="../../../index.html"/>
        <link rel="up" title="Data processing" href="00_overview.html"/>
        <link rel="next" title="Weights" href="../weights/00_overview.html"/>
        <link rel="prev" title="Logic and set operaters" href="06_logics.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Quantipy
          

          
          </a>

          
            
            
              <div class="version">
                0.1.3
              </div>
            
          

          
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/00_overview.html">Release notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/01_latest.html">Latest (xx/04/2019)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/02_archive.html">Archived release notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-14-01-2019">sd (14/01/2019)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-26-10-2018">sd (26/10/2018)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-01-10-2018">sd (01/10/2018)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-04-06-2018">sd (04/06/2018)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-04-04-2018">sd (04/04/2018)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-27-02-2018">sd (27/02/2018)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-12-01-2018">sd (12/01/2018)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-18-12-2017">sd (18/12/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-28-11-2017">sd (28/11/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-13-11-2017">sd (13/11/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-17-10-2017">sd (17/10/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-15-09-2017">sd (15/09/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-31-08-2017">sd (31/08/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-24-07-2017">sd (24/07/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-08-06-2017">sd (08/06/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-17-05-2017">sd (17/05/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-04-05-2017">sd (04/05/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-24-04-2017">sd (24/04/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-06-04-2017">sd (06/04/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-29-03-2017">sd (29/03/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-20-03-2017">sd (20/03/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-07-03-2017">sd (07/03/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-24-02-2017">sd (24/02/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-16-02-2017">sd (16/02/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-04-01-2017">sd (04/01/2017)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-8-12-2016">sd (8/12/2016)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-23-11-2016">sd (23/11/2016)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-16-11-2016">sd (16/11/2016)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-11-11-2016">sd (11/11/2016)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/02_archive.html#sd-09-11-2016">sd (09/11/2016)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../release_notes/03_how_to_snippets.html">How-to-snippets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/how_to_snippets/dimensions_comp.html"><code class="docutils literal notranslate"><span class="pre">DataSet</span></code> Dimensions compatibility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes/how_to_snippets/dimensions_comp.html#the-compatibility-mode">The compatibility mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes/how_to_snippets/dimensions_comp.html#accessing-and-creating-array-data">Accessing and creating <code class="docutils literal notranslate"><span class="pre">array</span></code> data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/how_to_snippets/create_categorical_meta.html">Different ways of creating categorical values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_notes/how_to_snippets/derotate.html">Derotation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes/how_to_snippets/derotate.html#what-is-derotation">What is derotation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes/how_to_snippets/derotate.html#how-to-use-dataset-derotate">How to use <code class="docutils literal notranslate"><span class="pre">DataSet.derotate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../release_notes/how_to_snippets/derotate.html#what-about-arrays">What about <code class="docutils literal notranslate"><span class="pre">arrays</span></code>?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="00_overview.html">Data processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_components.html">DataSet components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="01_components.html#case-and-meta-data">Case and meta data</a></li>
<li class="toctree-l3"><a class="reference internal" href="01_components.html#columns-and-masks-objects"><code class="docutils literal notranslate"><span class="pre">columns</span></code> and <code class="docutils literal notranslate"><span class="pre">masks</span></code> objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="01_components.html#languages-text-and-text-key-mappings">Languages: <code class="docutils literal notranslate"><span class="pre">text</span></code> and <code class="docutils literal notranslate"><span class="pre">text_key</span></code> mappings</a></li>
<li class="toctree-l3"><a class="reference internal" href="01_components.html#categorical-values-object">Categorical <code class="docutils literal notranslate"><span class="pre">values</span></code> object</a></li>
<li class="toctree-l3"><a class="reference internal" href="01_components.html#the-array-type">The <code class="docutils literal notranslate"><span class="pre">array</span></code> type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02_io.html">I/O</a><ul>
<li class="toctree-l3"><a class="reference internal" href="02_io.html#starting-from-native-components">Starting from native components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="02_io.html#using-a-standalone-pd-dataframe">Using a standalone <code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="02_io.html#csv-json-pairs"><code class="docutils literal notranslate"><span class="pre">.csv</span></code> / <code class="docutils literal notranslate"><span class="pre">.json</span></code> pairs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="02_io.html#third-party-conversions">Third party conversions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="02_io.html#supported-conversions">Supported conversions</a></li>
<li class="toctree-l4"><a class="reference internal" href="02_io.html#spss-statistics">SPSS Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="02_io.html#dimensions">Dimensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="02_io.html#decipher">Decipher</a></li>
<li class="toctree-l4"><a class="reference internal" href="02_io.html#ascribe">Ascribe</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02a_management.html">DataSet management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="02a_management.html#setting-the-variable-order">Setting the variable order</a></li>
<li class="toctree-l3"><a class="reference internal" href="02a_management.html#cloning-filtering-and-subsetting">Cloning, filtering and subsetting</a></li>
<li class="toctree-l3"><a class="reference internal" href="02a_management.html#merging">Merging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="02a_management.html#vertical-cases-rows-merging">Vertical (cases/rows) merging</a></li>
<li class="toctree-l4"><a class="reference internal" href="02a_management.html#horizontal-variables-columns-merging">Horizontal (variables/columns) merging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="02a_management.html#savepoints-and-state-rollback">Savepoints and state rollback</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="03_inspection.html">Inspecting variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="03_inspection.html#querying-and-slicing-case-data">Querying and slicing case data</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_inspection.html#variable-and-value-existence">Variable and value existence</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_inspection.html#variable-types">Variable types</a></li>
<li class="toctree-l3"><a class="reference internal" href="03_inspection.html#slicing-dicing-metadata-objects">Slicing &amp; dicing  metadata objects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="04_editing.html">Editing metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="04_editing.html#creating-meta-from-scratch">Creating meta from scratch</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_editing.html#renaming">Renaming</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_editing.html#changing-adding-text-info">Changing &amp; adding <code class="docutils literal notranslate"><span class="pre">text</span></code> info</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_editing.html#extending-the-values-object">Extending the <code class="docutils literal notranslate"><span class="pre">values</span></code> object</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_editing.html#reordering-the-values-object">Reordering the <code class="docutils literal notranslate"><span class="pre">values</span></code> object</a></li>
<li class="toctree-l3"><a class="reference internal" href="04_editing.html#removing-dataset-objects">Removing <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> objects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="05_transforming.html">Transforming variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="05_transforming.html#copying">Copying</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_transforming.html#inplace-type-conversion">Inplace type conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_transforming.html#banding-and-categorization">Banding and categorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="05_transforming.html#array-transformations">Array transformations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="06_logics.html">Logic and set operaters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="06_logics.html#ranges">Ranges</a></li>
<li class="toctree-l3"><a class="reference internal" href="06_logics.html#complex-logic">Complex logic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#union"><code class="docutils literal notranslate"><span class="pre">union</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#intersection"><code class="docutils literal notranslate"><span class="pre">intersection</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#list-logic">“List” logic</a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#has-any"><code class="docutils literal notranslate"><span class="pre">has_any</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#not-any"><code class="docutils literal notranslate"><span class="pre">not_any</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#has-all"><code class="docutils literal notranslate"><span class="pre">has_all</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#not-all"><code class="docutils literal notranslate"><span class="pre">not_all</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#has-count"><code class="docutils literal notranslate"><span class="pre">has_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="06_logics.html#not-count"><code class="docutils literal notranslate"><span class="pre">not_count</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="06_logics.html#boolean-slicers-and-code-existence">Boolean slicers and code existence</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Custom data recoding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-recode-method-in-detail">The <code class="docutils literal notranslate"><span class="pre">recode()</span></code> method in detail</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#target"><code class="docutils literal notranslate"><span class="pre">target</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mapper"><code class="docutils literal notranslate"><span class="pre">mapper</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#default"><code class="docutils literal notranslate"><span class="pre">default</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#append"><code class="docutils literal notranslate"><span class="pre">append</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#intersect"><code class="docutils literal notranslate"><span class="pre">intersect</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialize"><code class="docutils literal notranslate"><span class="pre">initialize</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#fillna"><code class="docutils literal notranslate"><span class="pre">fillna</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#custom-recode-examples">Custom recode examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-a-net-code">Building a net code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-and-fill">Create-and-fill</a></li>
<li class="toctree-l4"><a class="reference internal" href="#numerical-banding">Numerical banding</a></li>
<li class="toctree-l4"><a class="reference internal" href="#complicated-segmentation">Complicated segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#variable-creation">Variable creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-derived-variables">Adding derived variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interlocking-variables">Interlocking variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#condition-based-code-removal">Condition-based code removal</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../weights/00_overview.html">Weights</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../weights/01_background.html">Background and methodology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../weights/01_background.html#the-statistical-problem">The statistical problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../weights/01_background.html#rim-weighting-concept">Rim weighting concept</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../weights/02_rim.html">Weight scheme setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../weights/02_rim.html#using-the-rim-class">Using the <code class="docutils literal notranslate"><span class="pre">Rim</span></code> class</a></li>
<li class="toctree-l3"><a class="reference internal" href="../weights/02_rim.html#target-distributions">Target distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../weights/02_rim.html#weight-groups-and-filters">Weight groups and filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../weights/02_rim.html#setting-group-targets">Setting group targets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../weights/02_rim.html#integration-within-dataset">Integration within <code class="docutils literal notranslate"><span class="pre">DataSet</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../weights/02_rim.html#weighting-and-weighted-aggregations">Weighting and weighted aggregations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../weights/02_rim.html#the-isolated-weight-dataframe">The isolated weight dataframe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../weights/03_diags.html">Diagnostics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../weights/03_diags.html#the-weighting-efficiency">The weighting efficiency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../weights/03_diags.html#gotchas">Gotchas</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../batch/00_overview.html"><code class="docutils literal notranslate"><span class="pre">Batch</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../batch/01_create_load.html">Creating/ Loading a <code class="docutils literal notranslate"><span class="pre">qp.Batch</span></code> instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../batch/02_variables.html">Adding variables to a <code class="docutils literal notranslate"><span class="pre">qp.Batch</span></code> instance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batch/02_variables.html#x-keys-and-y-keys">x-keys and y-keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../batch/02_variables.html#arrays">Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="../batch/02_variables.html#verbatims-open-ends">Verbatims/ open ends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../batch/02_variables.html#special-aggregations">Special aggregations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batch/03_properties.html">Set properties of a <code class="docutils literal notranslate"><span class="pre">qp.Batch</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../batch/03_properties.html#filter-weights-and-significance-testing">Filter, weights and significance testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../batch/03_properties.html#cell-items-and-language">Cell items and language</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../batch/04_subclass.html">Inherited <code class="docutils literal notranslate"><span class="pre">qp.DataSet</span></code> methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../engine/00_overview.html">Analysis &amp; aggregation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../engine/01_links_stacks.html">Collecting aggregations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../engine/01_links_stacks.html#what-is-a-qp-link">What is a <code class="docutils literal notranslate"><span class="pre">qp.Link?</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../engine/01_links_stacks.html#populating-a-qp-stack">Populating a <code class="docutils literal notranslate"><span class="pre">qp.Stack</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../engine/02_quantity.html">The computational engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engine/03_test.html">Significance testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../engine/04_agg_methods.html">View aggregation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../engine/04_agg_methods.html#basic-views">Basic views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../engine/04_agg_methods.html#non-categorical-variables">Non-categorical variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../engine/04_agg_methods.html#descriptive-statistics">Descriptive statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../engine/04_agg_methods.html#nets">Nets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../engine/04_agg_methods.html#net-definitions">Net definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../engine/04_agg_methods.html#calculations">Calculations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../engine/04_agg_methods.html#cumulative-sums">Cumulative sums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../engine/04_agg_methods.html#significance-tests">Significance tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../builds/00_overview.html">Builds</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../builds/01_chains.html">Combining results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../builds/01_chains.html#organizing-view-aggregations">Organizing <code class="docutils literal notranslate"><span class="pre">View</span></code> aggregations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../builds/01_chains.html#creating-chain-aggregations">Creating <code class="docutils literal notranslate"><span class="pre">Chain</span></code> aggregations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../builds/02_cm_edits.html">Deriving post aggregation results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../builds/02_cm_edits.html#summarizing-and-reducing-results">Summarizing and reducing results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../builds/02_cm_edits.html#custom-calculations">Custom calculations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_ref/00overview.html">API references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/Chain.html">Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/Cluster.html">Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/DataSet.html">DataSet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/quantify_engine.html">quantify.engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/QuantipyViews.html">QuantipyViews</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/Rim_scheme.html">Rim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/View.html">View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_ref/ViewMapper.html">ViewMapper</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Quantipy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="00_overview.html">Data processing</a> &raquo;</li>
      
    <li>Custom data recoding</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/sites/lib_doc/dataprocessing/07_custom_recoding.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="custom-data-recoding">
<h1>Custom data recoding<a class="headerlink" href="#custom-data-recoding" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-recode-method-in-detail">
<h2>The <code class="docutils literal notranslate"><span class="pre">recode()</span></code> method in detail<a class="headerlink" href="#the-recode-method-in-detail" title="Permalink to this headline">¶</a></h2>
<p>This function takes a mapper of <code class="docutils literal notranslate"><span class="pre">{key:</span> <span class="pre">logic}</span></code> entries and injects the
key into the target column where its paired logic is True. The logic
may be arbitrarily complex and may refer to any other variable or
variables in data. Where a pre-existing column has been used to
start the recode, the injected values can replace or be appended to
any data found there to begin with. Note that this function does
not edit the target column, it returns a recoded copy of the target
column. The recoded data will always comply with the column type
indicated for the target column according to the meta.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">method:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">recode(target,</span> <span class="pre">mapper,</span> <span class="pre">default=None,</span> <span class="pre">append=False,</span>
<span class="pre">intersect=None,</span> <span class="pre">initialize=None,</span> <span class="pre">fillna=None,</span> <span class="pre">inplace=True)</span></code></td>
</tr>
</tbody>
</table>
<div class="section" id="target">
<h3><code class="docutils literal notranslate"><span class="pre">target</span></code><a class="headerlink" href="#target" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">target</span></code> controls which column meta should be used to control the
result of the recode operation. This is important because you cannot
recode multiple responses into a ‘single’-typed column.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target</span></code> column <strong>must</strong> already exist in meta.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">recode</span></code> function is effectively a request to return a copy of
the <code class="docutils literal notranslate"><span class="pre">target</span></code> column, recoded as instructed. <code class="docutils literal notranslate"><span class="pre">recode</span></code> does not
edit the <code class="docutils literal notranslate"><span class="pre">target</span></code> column in place, it returns a recoded copy of it.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">target</span></code> column does not already exist in <code class="docutils literal notranslate"><span class="pre">data</span></code> then a new
series, named accordingly and initialized with <code class="docutils literal notranslate"><span class="pre">np.NaN</span></code>, will begin
the recode.</p>
<p>Return a recoded version of the column <code class="docutils literal notranslate"><span class="pre">radio_stations_xb</span></code> edited
based on the given mapper:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="n">mapper</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>By default, recoded data resulting from the the mapper will replace any
data already sitting in the target column (on a cell-by-cell basis).</p>
</div>
<div class="section" id="mapper">
<h3><code class="docutils literal notranslate"><span class="pre">mapper</span></code><a class="headerlink" href="#mapper" title="Permalink to this headline">¶</a></h3>
<p>A mapper is a dict of <code class="docutils literal notranslate"><span class="pre">{value:</span> <span class="pre">logic}</span></code> entries where value represents
the data that will be injected for cases where the logic is True.</p>
<p>Here’s a simplified example of what a mapper looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="p">:</span> <span class="n">logic_A</span><span class="p">,</span>
<span class="gp">... </span>    <span class="mi">2</span><span class="p">:</span> <span class="n">logic_B</span><span class="p">,</span>
<span class="gp">... </span>    <span class="mi">3</span><span class="p">:</span> <span class="n">logic_C</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>1 will be generated where <code class="docutils literal notranslate"><span class="pre">logic_A</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, 2 where <code class="docutils literal notranslate"><span class="pre">logic_B</span></code> is
<code class="docutils literal notranslate"><span class="pre">True</span></code> and 3 where <code class="docutils literal notranslate"><span class="pre">logic_C</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>The recode function, by referencing the type indicated by the meta,
will manage the complications involved in single vs delimited set
data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">901</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="mi">902</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="mi">903</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">)}</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>This means: inject 901 if the column <code class="docutils literal notranslate"><span class="pre">radio_stations</span></code> has any of the
values 1-13, 902 where <code class="docutils literal notranslate"><span class="pre">radio_stations</span></code> has any of the values 14-20
and 903 where <code class="docutils literal notranslate"><span class="pre">radio_stations</span></code> has any of the values 21-25.</p>
</div>
<div class="section" id="default">
<h3><code class="docutils literal notranslate"><span class="pre">default</span></code><a class="headerlink" href="#default" title="Permalink to this headline">¶</a></h3>
<p>If you had lots of values to generate from the same reference column
(say most/all of them were based on <code class="docutils literal notranslate"><span class="pre">radio_stations</span></code>) then we can
omit the wildcard logic format and use recode’s default parameter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>This means, all unkeyed logic will default to be keyed to
<code class="docutils literal notranslate"><span class="pre">radio_stations</span></code>. In this case the three codes 901, 902 and 903 will
be generated based on the data found in <code class="docutils literal notranslate"><span class="pre">radio_stations</span></code>.</p>
<p>You can combine this with reference to other columns, but you can only
provide one default column.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Given that logic can be arbitrarily complicated, mappers can be as
well. You’ll see an example of a mapper that recodes a segmentation
in <strong>Example 4</strong>, below.</p>
</div>
<div class="section" id="append">
<h3><code class="docutils literal notranslate"><span class="pre">append</span></code><a class="headerlink" href="#append" title="Permalink to this headline">¶</a></h3>
<p>If you want the recoded data to be appended to whatever may
already be in the target column (this is only applicable for ‘delimited
set’-typed columns), then you should use the append parameter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="n">mapper</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>The precise behaviour of the append parameter can be seen in the
following examples.</p>
<p>Given the following data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span>
<span class="go">1    6;7;9;13;</span>
<span class="go">2          97;</span>
<span class="go">3          97;</span>
<span class="go">4    13;16;18;</span>
<span class="go">5         2;6;</span>
<span class="go">Name: radio_stations_xb, dtype: object</span>
</pre></div>
</div>
<p>We generate a recoded value of 901 if any of the values 1-13 are
found. With the default <code class="docutils literal notranslate"><span class="pre">append=False</span></code> behaviour we will return the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;radio_stations_xb&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recode</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapper</span><span class="p">)</span>
<span class="go">1    901;</span>
<span class="go">2     97;</span>
<span class="go">3     97;</span>
<span class="go">4    901;</span>
<span class="go">5    901;</span>
<span class="go">Name: radio_stations_xb, dtype: object</span>
</pre></div>
</div>
<p>However, if we instead use <code class="docutils literal notranslate"><span class="pre">append=True</span></code>, we will return the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;radio_stations_xb&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recode</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">1    6;7;9;13;901;</span>
<span class="go">2              97;</span>
<span class="go">3              97;</span>
<span class="go">4    13;16;18;901;</span>
<span class="go">5         2;6;901;</span>
<span class="go">Name: radio_stations_xb, dtype: object</span>
</pre></div>
</div>
</div>
<div class="section" id="intersect">
<h3><code class="docutils literal notranslate"><span class="pre">intersect</span></code><a class="headerlink" href="#intersect" title="Permalink to this headline">¶</a></h3>
<p>One way to help simplify complex logical conditions, especially when
they are in some way repetitive, is to use <code class="docutils literal notranslate"><span class="pre">intersect</span></code>, which
accepts any logical statement and forces every condition in the mapper
to become the intersection of both it and the intersect condition.</p>
<p>For example, we could limit our recode to males by giving a logical
condition to that effect to <code class="docutils literal notranslate"><span class="pre">intersect</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">intersect</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize">
<h3><code class="docutils literal notranslate"><span class="pre">initialize</span></code><a class="headerlink" href="#initialize" title="Permalink to this headline">¶</a></h3>
<p>You may also <code class="docutils literal notranslate"><span class="pre">initialize</span></code> your copy of the target column as part of your
recode operation. You can <code class="docutils literal notranslate"><span class="pre">initalize</span></code> with either np.NaN (to overwrite
anything that may already be there when your recode begins) or by naming
another column. When you name another column a copy of the data from that
column is used to initialize your recode.</p>
<p>Initialization occurs <strong>before</strong> your recode.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initialize</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fillna">
<h3><code class="docutils literal notranslate"><span class="pre">fillna</span></code><a class="headerlink" href="#fillna" title="Permalink to this headline">¶</a></h3>
<p>You may also provide a <code class="docutils literal notranslate"><span class="pre">fillna</span></code> value that will be used as per
<code class="docutils literal notranslate"><span class="pre">pd.Series.fillna()</span></code> <strong>after</strong> the recode has been performed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">recoded</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-13&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">902</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;14-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">903</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">904</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-34&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initialize</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">fillna</span><span class="o">=</span><span class="mi">99</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-recode-examples">
<h2>Custom recode examples<a class="headerlink" href="#custom-recode-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="building-a-net-code">
<h3>Building a net code<a class="headerlink" href="#building-a-net-code" title="Permalink to this headline">¶</a></h3>
<p>Here’s an example of copying an existing question and recoding onto it a
net code.</p>
<p>Create the new metadata:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">901</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;en-GB&quot;</span><span class="p">:</span> <span class="s2">&quot;NET: Listened to radio in past 30 days&quot;</span><span class="p">}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Initialize the new column. In this case we’re starting with a copy of
the <code class="docutils literal notranslate"><span class="pre">radio_stations</span></code> column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>Recode the new column by appending the code 901 to it as indicated
by the mapper:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">901</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;1-23, 92, 94, 141&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">append</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;radio_stations&#39;</span><span class="p">,</span> <span class="s1">&#39;radio_stations_xb&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">   radio_stations radio_stations_cb</span>
<span class="go">0              5;            5;901;</span>
<span class="go">1             97;               97;</span>
<span class="go">2             97;               97;</span>
<span class="go">3             97;               97;</span>
<span class="go">4             97;               97;</span>
<span class="go">5              4;            4;901;</span>
<span class="go">6             11;           11;901;</span>
<span class="go">7              4;            4;901;</span>
<span class="go">8             97;               97;</span>
<span class="go">9             97;               97;</span>
<span class="go">10            97;               97;</span>
<span class="go">11            92;           92;901;</span>
<span class="go">12            97;               97;</span>
<span class="go">13       1;13;17;      1;13;17;901;</span>
<span class="go">14             6;            6;901;</span>
<span class="go">15      1;5;6;10;     1;5;6;10;901;</span>
<span class="go">16             6;            6;901;</span>
<span class="go">17        2;4;16;       2;4;16;901;</span>
<span class="go">18          6;10;         6;10;901;</span>
<span class="go">19             6;            6;901;</span>
</pre></div>
</div>
</div>
<div class="section" id="create-and-fill">
<h3>Create-and-fill<a class="headerlink" href="#create-and-fill" title="Permalink to this headline">¶</a></h3>
<p>Here’s an example where the value 1 is generated based on some logic
and then all remaining cases are given the value 2 using the
pandas.Series.fillna() method.</p>
<p>Create the new metadata</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Age&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;16-25&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Others&#39;</span><span class="p">}}</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span>    <span class="p">}</span>
</pre></div>
</div>
<p>Initialize the new column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
</pre></div>
</div>
<p>Recode the new column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;age_xb&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;16-40&#39;</span><span class="p">)}</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Fill all cases that are still empty with the value 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_xb&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">    age  age_grp_rc</span>
<span class="go">0    22           1</span>
<span class="go">1    68           2</span>
<span class="go">2    32           1</span>
<span class="go">3    44           2</span>
<span class="go">4    33           1</span>
<span class="go">5    52           2</span>
<span class="go">6    54           2</span>
<span class="go">7    44           2</span>
<span class="go">8    62           2</span>
<span class="go">9    49           2</span>
<span class="go">10   64           2</span>
<span class="go">11   73           2</span>
<span class="go">12   43           2</span>
<span class="go">13   28           1</span>
<span class="go">14   66           2</span>
<span class="go">15   39           1</span>
<span class="go">16   51           2</span>
<span class="go">17   50           2</span>
<span class="go">18   77           2</span>
<span class="go">19   42           2</span>
</pre></div>
</div>
</div>
<div class="section" id="numerical-banding">
<h3>Numerical banding<a class="headerlink" href="#numerical-banding" title="Permalink to this headline">¶</a></h3>
<p>Here’s a typical example of recoding age into custom bands.</p>
<p>In this case we’re using list comprehension to generate the first ten
values objects and then concatenate that with a final ‘65+’ value object
which doesn’t folow the same label format.</p>
<p>Create the new metadata:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Age&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])}</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
<span class="gp">... </span>            <span class="p">[</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span> <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span> <span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">55</span><span class="p">],</span> <span class="p">[</span><span class="mi">56</span><span class="p">,</span> <span class="mi">60</span><span class="p">],</span>
<span class="gp">... </span>                <span class="p">[</span><span class="mi">61</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>
<span class="gp">... </span>            <span class="p">],</span>
<span class="gp">... </span>            <span class="n">start</span><span class="o">=</span><span class="mi">1</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;65+&#39;</span><span class="p">}</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Initialize the new column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
</pre></div>
</div>
<p>Recode the new column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;age_xb_1&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="mi">1</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;18-20&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">2</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;21-25&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">3</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;26-30&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">4</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;31-35&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">5</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;36-40&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">6</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;41-45&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">7</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;46-50&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">8</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;51-55&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">9</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;56-60&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">10</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;61-65&#39;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="mi">11</span><span class="p">:</span> <span class="n">frange</span><span class="p">(</span><span class="s1">&#39;66-99&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;age&#39;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;age_xb_1&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">    age  age_cb</span>
<span class="go">0    22       2</span>
<span class="go">1    68      11</span>
<span class="go">2    32       4</span>
<span class="go">3    44       6</span>
<span class="go">4    33       4</span>
<span class="go">5    52       8</span>
<span class="go">6    54       8</span>
<span class="go">7    44       6</span>
<span class="go">8    62      10</span>
<span class="go">9    49       7</span>
<span class="go">10   64      10</span>
<span class="go">11   73      11</span>
<span class="go">12   43       6</span>
<span class="go">13   28       3</span>
<span class="go">14   66      11</span>
<span class="go">15   39       5</span>
<span class="go">16   51       8</span>
<span class="go">17   50       7</span>
<span class="go">18   77      11</span>
<span class="go">19   42       6</span>
</pre></div>
</div>
</div>
<div class="section" id="complicated-segmentation">
<h3>Complicated segmentation<a class="headerlink" href="#complicated-segmentation" title="Permalink to this headline">¶</a></h3>
<p>Here’s an example of using a complicated, nested series of logic
statements to recode an obscure segmentation.</p>
<p>The segemenation was given with the following definition:</p>
<p><strong>1 - Self-directed:</strong></p>
<ul class="simple">
<li>If q1_1 in [1,2] and q1_2 in [1,2] and q1_3 in [3,4,5]</li>
</ul>
<p><strong>2 - Validators:</strong></p>
<ul class="simple">
<li>If q1_1 in [1,2] and q1_2 in [1,2] and q1_3 in [1,2]</li>
</ul>
<p><strong>3 - Delegators:</strong></p>
<ul class="simple">
<li>If (q1_1 in [3,4,5] and q1_2 in [3,4,5] and q1_3 in [1,2])</li>
<li>Or (q1_1 in [3,4,5] and q1_2 in [1,2] and q1_3 in [1,2])</li>
<li>Or (q1_1 in [1,2] and q1_2 in [3,4,5] and q1_3 in [1,2])</li>
</ul>
<p><strong>4 - Avoiders:</strong></p>
<ul class="simple">
<li>If (q1_1 in [3,4,5] and q1_2 in [3,4,5] and q1_3 in [3,4,5])</li>
<li>Or (q1_1 in [3,4,5] and q1_2 in [1,2] and q1_3 in [3,4,5])</li>
<li>Or (q1_1 in [1,2] and q1_2 in [3,4,5] and q1_3 in [3,4,5])</li>
</ul>
<p><strong>5 - Others:</strong></p>
<ul class="simple">
<li>Everyone else.</li>
</ul>
<p>Create the new metadata:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;columns&#39;</span><span class="p">][</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Segments&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Self-directed&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Validators&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Delegators&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Avoiders&#39;</span><span class="p">}},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;en-GB&#39;</span><span class="p">:</span> <span class="s1">&#39;Other&#39;</span><span class="p">}},</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Initialize the new column?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
</pre></div>
</div>
<p>Create the mapper separately, since it’s pretty massive!</p>
<p>See the <strong>Complex logic</strong> section for more information and examples
related to the use of <code class="docutils literal notranslate"><span class="pre">union</span></code> and <code class="docutils literal notranslate"><span class="pre">intersection</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="p">:</span> <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>    <span class="p">]),</span>
<span class="gp">... </span>    <span class="mi">2</span><span class="p">:</span> <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>    <span class="p">]),</span>
<span class="gp">... </span>    <span class="mi">3</span><span class="p">:</span> <span class="n">union</span><span class="p">([</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>    <span class="p">]),</span>
<span class="gp">... </span>    <span class="mi">4</span><span class="p">:</span> <span class="n">union</span><span class="p">([</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">]),</span>
<span class="gp">... </span>        <span class="n">intersection</span><span class="p">([</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span>
<span class="gp">... </span>            <span class="p">{</span><span class="s2">&quot;q1_3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>
<span class="gp">... </span>        <span class="p">])</span>
<span class="gp">... </span>    <span class="p">])</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Recode the new column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recode</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">meta</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">target</span><span class="o">=</span><span class="s1">&#39;segments&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mapper</span><span class="o">=</span><span class="n">mapper</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Anything not at the top level of the mapper will not benefit from using
the <code class="docutils literal notranslate"><span class="pre">default</span></code> parameter of the recode function. In this case, for example,
saying <code class="docutils literal notranslate"><span class="pre">default='q1_1'</span></code> would not have helped. Everything in a nested level
of the mapper, including anything in a <code class="docutils literal notranslate"><span class="pre">union</span></code> or <code class="docutils literal notranslate"><span class="pre">intersection</span></code> list,
must use the explicit dict form <code class="docutils literal notranslate"><span class="pre">{&quot;q1_1&quot;:</span> <span class="pre">[1,</span> <span class="pre">2]}</span></code>.</p>
</div>
<p>Fill all cases that are still empty with the value 5:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;segments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Check the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;q1_1&#39;</span><span class="p">,</span> <span class="s1">&#39;q1_2&#39;</span><span class="p">,</span> <span class="s1">&#39;q1_3&#39;</span><span class="p">,</span> <span class="s1">&#39;segments&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="go">    q1_1  q1_2  q1_3  segments</span>
<span class="go">0      3     3     3         4</span>
<span class="go">1      3     3     3         4</span>
<span class="go">2      1     1     3         1</span>
<span class="go">3      1     1     2         2</span>
<span class="go">4      2     2     2         2</span>
<span class="go">5      1     1     5         1</span>
<span class="go">6      2     3     2         3</span>
<span class="go">7      2     2     3         1</span>
<span class="go">8      1     1     4         1</span>
<span class="go">9      3     3     3         4</span>
<span class="go">10     3     3     4         4</span>
<span class="go">11     2     2     4         1</span>
<span class="go">12     1     1     5         1</span>
<span class="go">13     2     2     4         1</span>
<span class="go">14     1     1     1         2</span>
<span class="go">15     2     2     4         1</span>
<span class="go">16     2     2     3         1</span>
<span class="go">17     1     1     5         1</span>
<span class="go">18     5     5     1         3</span>
<span class="go">19     1     1     4         1</span>
</pre></div>
</div>
</div>
<div class="section" id="variable-creation">
<h3>Variable creation<a class="headerlink" href="#variable-creation" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="adding-derived-variables">
<h3>Adding derived variables<a class="headerlink" href="#adding-derived-variables" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="interlocking-variables">
<h3>Interlocking variables<a class="headerlink" href="#interlocking-variables" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="condition-based-code-removal">
<h3>Condition-based code removal<a class="headerlink" href="#condition-based-code-removal" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../weights/00_overview.html" class="btn btn-neutral float-right" title="Weights" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="06_logics.html" class="btn btn-neutral" title="Logic and set operaters" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Quantipy dev team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/custom.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>